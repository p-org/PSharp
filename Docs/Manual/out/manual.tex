\documentclass{article}
% generated by Madoko, version 0.9.5-beta
%mdk-data-line={1}

\usepackage[heading-base=2]{madoko}
\usepackage[left=1.25in,right=1.25in,top=1.25in,bottom=1.5in]{geometry}


\begin{document}
\begin{mdDiv}[class={body,madoko},elem={body},line-adjust={0}]%mdk
\begin{mdDiv}[class={titleblock,titleblockmaketitle},elem={titleblock},display={inline-block},line-adjust={0},data-line={26}]%mdk
%mdk-data-line={26}
{}\mdxTitle{The P\# Tutorial}\begin{mdDiv}[class={author,authormaketitle},elem={author},display={inline-block},line-adjust={0},data-line={31}]%mdk
%mdk-data-line={31}
{}\mdxAuthorName{Pantazis Deligiannis}%mdk-data-line={34}
{}\mdxAuthorEmail{p.deligiannis@imperial.ac.uk}%mdk
\end{mdDiv}%mdk
\begin{mdDiv}[class={author,authormaketitle},elem={author},display={inline-block},line-adjust={0},data-line={39}]%mdk
%mdk-data-line={39}
{}\mdxAuthorName{Shaz Qadeer}%mdk-data-line={42}
{}\mdxAuthorEmail{qadeer@microsoft.com}%mdk
\end{mdDiv}%mdk
\begin{mdDiv}[class={author,authormaketitle},elem={author},display={inline-block},line-adjust={0},data-line={47}]%mdk
%mdk-data-line={47}
{}\mdxAuthorName{Akash Lal}%mdk-data-line={50}
{}\mdxAuthorEmail{akashl@microsoft.com}%mdk
\end{mdDiv}%mdk%mdk
\end{mdDiv}%mdk
\mdHxx[id=sec-introduction,label={[1]\{.heading-label\}},toc={},font-weight={normal},data-line={28},caption={[[1]\{.heading-label\}.{\hspace*{0.5em}}]\{.heading-before\}Introduction},bookmark={1.{\hspace*{0.5em}}Introduction}]{%mdk-data-line={28}
{}\mdSpan[class={heading-before}]{\mdSpan[class={heading-label}]{1}.{\hspace*{0.5em}}}%mdk-data-line={28}
{}Introduction}\begin{mdP}[data-line={30}]%mdk
%mdk-data-line={30}
{}P%mdk-data-line={30}
{}\#%mdk-data-line={30}
{} is an actor-based programming language for develoPing highly-reliable event-driven
asynchronous .NET applications. The computational model underlying a P%mdk-data-line={31}
{}\#%mdk-data-line={31}
{} program is
%mdk-data-line={32}
{}\mdEm{communicating state-machines}%mdk-data-line={32}
{} (similar concept to actors). P%mdk-data-line={32}
{}\#%mdk-data-line={32}
{} machines communicate
by sending and receiving %mdk-data-line={33}
{}\mdEm{events}%mdk-data-line={33}
{}, an approach commonly used in building embedded,
networked, and distributed systems. P%mdk-data-line={34}
{}\#%mdk-data-line={34}
{} is an extension of the C%mdk-data-line={34}
{}\#%mdk-data-line={34}
{} language: it
provides new language primitives for creating machines and sending events from a
machine to another. Because P%mdk-data-line={36}
{}\#%mdk-data-line={36}
{} is built on top of C%mdk-data-line={36}
{}\#%mdk-data-line={36}
{}, the programmer can blend P%mdk-data-line={36}
{}\#%mdk-data-line={36}
{} and
C%mdk-data-line={37}
{}\#%mdk-data-line={37}
{} code: this not only lowers the overhead of learning a new language, but also
allows P%mdk-data-line={38}
{}\#%mdk-data-line={38}
{} to easily integrate with existing .NET projects.%mdk
\end{mdP}%mdk
\begin{mdP}[class={indent},data-line={40}]%mdk
%mdk-data-line={40}
{}In P%mdk-data-line={40}
{}\#%mdk-data-line={40}
{}, machines are first class citizens of the language (similar to how classes are
first class citizens in C%mdk-data-line={41}
{}\#%mdk-data-line={41}
{}). Each machine has an input queue, states, transitions,
event handlers, fields and methods. Machines run concurrently with each other, each
executing an event handling loop that dequeues an event from the input queue and
handles it by executing a sequence of operations. Each operation might update a field,
create a new machine, or send an event to another machine. In P%mdk-data-line={45}
{}\#%mdk-data-line={45}
{}, a send operation is
non-blocking; the message is simply enqueued into the input queue of the target machine.%mdk
\end{mdP}%mdk
\begin{mdP}[class={indent},data-line={48}]%mdk
%mdk-data-line={48}
{}In the rest of this tutorial, we will introduce the features of P%mdk-data-line={48}
{}\#%mdk-data-line={48}
{} through a series of
examples.
We will first present a simple program (Section%mdk-data-line={50}
{}{\mdNbsp}\mdA[class={localref},target-element={h1}]{sec-simple-program}{}{\mdSpan[class={heading-label}]{2}}%mdk-data-line={50}
{}) that illustrates
the basic features of the P%mdk-data-line={51}
{}\#%mdk-data-line={51}
{} state-machine programming model.
Next, we present a more advanced example (Section%mdk-data-line={52}
{}{\mdNbsp}\mdA[class={localref},target-element={h1}]{sec-advanced-features}{}{\mdSpan[class={heading-label}]{3}}%mdk-data-line={52}
{}) that illustrates
advanced features of the P%mdk-data-line={53}
{}\#%mdk-data-line={53}
{} language.
Finally, we will provide an overview of the tools for compiling and systematically testing
a P%mdk-data-line={55}
{}\#%mdk-data-line={55}
{} program (Section%mdk-data-line={55}
{}{\mdNbsp}\mdA[class={localref},target-element={h1}]{sec-tools}{}{\mdSpan[class={heading-label}]{4}}%mdk-data-line={55}
{}) and conclude with a glossary of all P%mdk-data-line={55}
{}\#%mdk-data-line={55}
{}-specific
features in our language (Section%mdk-data-line={56}
{}{\mdNbsp}\mdA[class={localref},target-element={h1}]{sec-glossary}{}{\mdSpan[class={heading-label}]{5}}%mdk-data-line={56}
{}).%mdk
\end{mdP}%mdk
\mdHxx[id=sec-simple-program,label={[2]\{.heading-label\}},toc={},font-weight={normal},data-line={58},caption={[[2]\{.heading-label\}.{\hspace*{0.5em}}]\{.heading-before\}A simple P\# program},bookmark={2.{\hspace*{0.5em}}A simple P\# program}]{%mdk-data-line={58}
{}\mdSpan[class={heading-before}]{\mdSpan[class={heading-label}]{2}.{\hspace*{0.5em}}}%mdk-data-line={58}
{}A simple P%mdk-data-line={58}
{}\#%mdk-data-line={58}
{} program}\begin{mdP}[data-line={60}]%mdk
%mdk-data-line={60}
{}A P%mdk-data-line={60}
{}\#%mdk-data-line={60}
{} program is a collection of %mdk-data-line={60}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Keyword,Psharp}{event}}%mdk-data-line={60}
{}, %mdk-data-line={60}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Keyword,Psharp}{machine}}%mdk-data-line={60}
{} and, optionally, other top-level C%mdk-data-line={60}
{}\#%mdk-data-line={60}
{}
declarations (e.g. %mdk-data-line={61}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Keyword,Psharp}{class}}%mdk-data-line={61}
{}). Events and machines must be declared inside a %mdk-data-line={61}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Delimiter,Psharp}{.}\mdToken{Identifier,Psharp}{psharp}}%mdk-data-line={61}
{}
file, while C%mdk-data-line={62}
{}\#%mdk-data-line={62}
{} top-level declarations must be declared in a typical %mdk-data-line={62}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Delimiter,Psharp}{.}\mdToken{Identifier,Psharp}{cs}}%mdk-data-line={62}
{} file.
Similar to C%mdk-data-line={63}
{}\#%mdk-data-line={63}
{}, all top-level declarations must be declared inside a %mdk-data-line={63}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Keyword,Psharp}{namespace}}%mdk-data-line={63}
{}.
The following example contains a %mdk-data-line={64}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{Client}}%mdk-data-line={64}
{} machine and a %mdk-data-line={64}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{Server}}%mdk-data-line={64}
{} machine communicating
with each other via %mdk-data-line={65}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{Ping}}%mdk-data-line={65}
{} and %mdk-data-line={65}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{Pong}}%mdk-data-line={65}
{} events.%mdk
\end{mdP}%mdk
\begin{mdPre}[class={para-block,pre-fenced,pre-fenced3,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp},data-line={67},data-line-code={68}]%mdk
\mdPrecode[data-line={68}]{\mdToken{Comment,Psharp}{//\prespace{1}PingPong.psharp}\prebr{}
\mdToken{Keyword,Psharp}{namespace}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{PingPong}{\prespace{1}}\mdToken{Delimiter,Curly,Psharp,BracketOpen}{\{}\prebr{}
{\preindent{2}}\mdToken{Keyword,Psharp}{event}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{Ping}\mdToken{Delimiter,Psharp}{;}\prebr{}
{\preindent{2}}\mdToken{Keyword,Psharp}{event}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{Pong}\mdToken{Delimiter,Psharp}{;}\prebr{}
{\preindent{2}}\mdToken{Keyword,Psharp}{event}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{Unit}\mdToken{Delimiter,Psharp}{;}\prebr{}
{\preindent{2}}\prebr{}
{\preindent{2}}\mdToken{Keyword,Psharp}{machine}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{Server}{\prespace{1}}\mdToken{Delimiter,Curly,Psharp,BracketOpen}{\{}\prebr{}
{\preindent{4}}\mdToken{Keyword,Psharp}{machine}{\prespace{1}}\mdToken{Identifier,Psharp}{client}\mdToken{Delimiter,Psharp}{;}\prebr{}
\prebr{}
{\preindent{4}}\mdToken{Keyword,Psharp}{start}{\prespace{1}}\mdToken{Keyword,Psharp}{state}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{Init}{\prespace{1}}\mdToken{Delimiter,Curly,Psharp,BracketOpen}{\{}\prebr{}
{\preindent{6}}\mdToken{Keyword,Psharp}{entry}{\prespace{1}}\mdToken{Delimiter,Curly,Psharp,BracketOpen}{\{}\prebr{}
{\preindent{8}}\mdToken{Keyword,Psharp}{this}\mdToken{Delimiter,Psharp}{.}\mdToken{Identifier,Psharp}{client}{\prespace{1}}\mdToken{Operator,Psharp}{=}{\prespace{1}}\mdToken{Keyword,Psharp}{create}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{Client}{\prespace{1}}\mdToken{Delimiter,Parenthesis,Psharp,BracketOpen}{(}{\prespace{1}}\mdToken{Keyword,Psharp}{this}{\prespace{1}}\mdToken{Delimiter,Parenthesis,Psharp,BracketClose}{)}\mdToken{Delimiter,Psharp}{;}\prebr{}
{\preindent{8}}\mdToken{Keyword,Psharp}{raise}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{Unit}\mdToken{Delimiter,Psharp}{;}\prebr{}
{\preindent{6}}\mdToken{Delimiter,Curly,Psharp,BracketClose}{\}}\prebr{}
\prebr{}
{\preindent{6}}\mdToken{Keyword,Psharp}{on}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{Unit}{\prespace{1}}\mdToken{Keyword,Psharp}{goto}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{Playing}\mdToken{Delimiter,Psharp}{;}\prebr{}
{\preindent{4}}\mdToken{Delimiter,Curly,Psharp,BracketClose}{\}}\prebr{}
\prebr{}
{\preindent{4}}\mdToken{Keyword,Psharp}{state}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{Playing}{\prespace{1}}\mdToken{Delimiter,Curly,Psharp,BracketOpen}{\{}\prebr{}
{\preindent{6}}\mdToken{Keyword,Psharp}{entry}{\prespace{1}}\mdToken{Delimiter,Curly,Psharp,BracketOpen}{\{}\prebr{}
{\preindent{8}}\mdToken{Keyword,Psharp}{send}{\prespace{1}}\mdToken{Keyword,Psharp}{this}\mdToken{Delimiter,Psharp}{.}\mdToken{Identifier,Psharp}{client}\mdToken{Delimiter,Psharp}{,}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{Pong}\mdToken{Delimiter,Psharp}{;}\prebr{}
{\preindent{6}}\mdToken{Delimiter,Curly,Psharp,BracketClose}{\}}\prebr{}
\prebr{}
{\preindent{6}}\mdToken{Keyword,Psharp}{on}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{Unit}{\prespace{1}}\mdToken{Keyword,Psharp}{do}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{SendPong}\mdToken{Delimiter,Psharp}{;}\prebr{}
{\preindent{6}}\mdToken{Keyword,Psharp}{on}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{Ping}{\prespace{1}}\mdToken{Keyword,Psharp}{do}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{SendPong}\mdToken{Delimiter,Psharp}{;}\prebr{}
{\preindent{4}}\mdToken{Delimiter,Curly,Psharp,BracketClose}{\}}\prebr{}
\prebr{}
{\preindent{4}}\mdToken{Keyword,Psharp}{void}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{SendPong}\mdToken{Delimiter,Parenthesis,Psharp,BracketOpen}{(}\mdToken{Delimiter,Parenthesis,Psharp,BracketClose}{)}{\prespace{1}}\mdToken{Delimiter,Curly,Psharp,BracketOpen}{\{}\prebr{}
{\preindent{6}}\mdToken{Keyword,Psharp}{send}{\prespace{1}}\mdToken{Keyword,Psharp}{this}\mdToken{Delimiter,Psharp}{.}\mdToken{Identifier,Psharp}{client}\mdToken{Delimiter,Psharp}{,}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{Pong}\mdToken{Delimiter,Psharp}{;}\prebr{}
{\preindent{4}}\mdToken{Delimiter,Curly,Psharp,BracketClose}{\}}\prebr{}
{\preindent{2}}\mdToken{Delimiter,Curly,Psharp,BracketClose}{\}}\prebr{}
\prebr{}
{\preindent{2}}\mdToken{Keyword,Psharp}{machine}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{Client}{\prespace{1}}\mdToken{Delimiter,Curly,Psharp,BracketOpen}{\{}\prebr{}
{\preindent{4}}\mdToken{Keyword,Psharp}{machine}{\prespace{1}}\mdToken{Identifier,Psharp}{server}\mdToken{Delimiter,Psharp}{;}\prebr{}
{\preindent{4}}\mdToken{Keyword,Psharp}{int}{\prespace{1}}\mdToken{Identifier,Psharp}{counter}\mdToken{Delimiter,Psharp}{;}\prebr{}
\prebr{}
{\preindent{4}}\mdToken{Keyword,Psharp}{start}{\prespace{1}}\mdToken{Keyword,Psharp}{state}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{Init}{\prespace{1}}\mdToken{Delimiter,Curly,Psharp,BracketOpen}{\{}\prebr{}
{\preindent{6}}\mdToken{Keyword,Psharp}{entry}{\prespace{1}}\mdToken{Delimiter,Curly,Psharp,BracketOpen}{\{}\prebr{}
{\preindent{8}}\mdToken{Keyword,Psharp}{this}\mdToken{Delimiter,Psharp}{.}\mdToken{Identifier,Psharp}{server}{\prespace{1}}\mdToken{Operator,Psharp}{=}{\prespace{1}}\mdToken{Delimiter,Parenthesis,Psharp,BracketOpen}{(}\mdToken{Keyword,Psharp}{machine}\mdToken{Delimiter,Parenthesis,Psharp,BracketClose}{)}\mdToken{Keyword,Psharp}{payload}\mdToken{Delimiter,Psharp}{;}\prebr{}
{\preindent{8}}\mdToken{Keyword,Psharp}{this}\mdToken{Delimiter,Psharp}{.}\mdToken{Identifier,Psharp}{counter}{\prespace{1}}\mdToken{Operator,Psharp}{=}{\prespace{1}}\mdToken{Number,Psharp}{0}\mdToken{Delimiter,Psharp}{;}\prebr{}
{\preindent{8}}\mdToken{Keyword,Psharp}{raise}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{Unit}\mdToken{Delimiter,Psharp}{;}\prebr{}
{\preindent{6}}\mdToken{Delimiter,Curly,Psharp,BracketClose}{\}}\prebr{}
\prebr{}
{\preindent{6}}\mdToken{Keyword,Psharp}{on}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{Unit}{\prespace{1}}\mdToken{Keyword,Psharp}{goto}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{Playing}\mdToken{Delimiter,Psharp}{;}\prebr{}
{\preindent{4}}\mdToken{Delimiter,Curly,Psharp,BracketClose}{\}}\prebr{}
\prebr{}
{\preindent{4}}\mdToken{Keyword,Psharp}{state}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{Playing}{\prespace{1}}\mdToken{Delimiter,Curly,Psharp,BracketOpen}{\{}\prebr{}
{\preindent{6}}\mdToken{Keyword,Psharp}{entry}{\prespace{1}}\mdToken{Delimiter,Curly,Psharp,BracketOpen}{\{}\prebr{}
{\preindent{8}}\mdToken{Keyword,Psharp}{if}{\prespace{1}}\mdToken{Delimiter,Parenthesis,Psharp,BracketOpen}{(}\mdToken{Keyword,Psharp}{this}\mdToken{Delimiter,Psharp}{.}\mdToken{Identifier,Psharp}{counter}{\prespace{1}}\mdToken{Operator,Psharp}{=}{\prespace{1}}\mdToken{Number,Psharp}{5}\mdToken{Delimiter,Parenthesis,Psharp,BracketClose}{)}{\prespace{1}}\mdToken{Delimiter,Curly,Psharp,BracketOpen}{\{}\prebr{}
{\preindent{10}}\mdToken{Keyword,Psharp}{send}{\prespace{1}}\mdToken{Keyword,Psharp}{this}\mdToken{Delimiter,Psharp}{.}\mdToken{Identifier,Psharp}{server}\mdToken{Delimiter,Psharp}{,}{\prespace{1}}\mdToken{Keyword,Psharp}{halt}\mdToken{Delimiter,Psharp}{;}\prebr{}
{\preindent{10}}\mdToken{Keyword,Psharp}{raise}{\prespace{1}}\mdToken{Keyword,Psharp}{halt}\mdToken{Delimiter,Psharp}{;}\prebr{}
{\preindent{8}}\mdToken{Delimiter,Curly,Psharp,BracketClose}{\}}\prebr{}
{\preindent{6}}\mdToken{Delimiter,Curly,Psharp,BracketClose}{\}}\prebr{}
\prebr{}
{\preindent{6}}\mdToken{Keyword,Psharp}{on}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{Unit}{\prespace{1}}\mdToken{Keyword,Psharp}{goto}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{Playing}\mdToken{Delimiter,Psharp}{;}\prebr{}
{\preindent{6}}\prebr{}
{\preindent{6}}\mdToken{Keyword,Psharp}{on}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{Pong}{\prespace{1}}\mdToken{Keyword,Psharp}{do}{\prespace{1}}\mdToken{Delimiter,Curly,Psharp,BracketOpen}{\{}\prebr{}
{\preindent{8}}\mdToken{Keyword,Psharp}{this}\mdToken{Delimiter,Psharp}{.}\mdToken{Identifier,Psharp}{counter}++\mdToken{Delimiter,Psharp}{;}\prebr{}
{\preindent{8}}\mdToken{Keyword,Psharp}{send}{\prespace{1}}\mdToken{Keyword,Psharp}{this}\mdToken{Delimiter,Psharp}{.}\mdToken{Identifier,Psharp}{server}\mdToken{Delimiter,Psharp}{,}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{Ping}\mdToken{Delimiter,Psharp}{;}\prebr{}
{\preindent{8}}\mdToken{Keyword,Psharp}{raise}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{Unit}\mdToken{Delimiter,Psharp}{;}\prebr{}
{\preindent{6}}\mdToken{Delimiter,Curly,Psharp,BracketClose}{\}}\mdToken{Delimiter,Psharp}{;}\prebr{}
{\preindent{4}}\mdToken{Delimiter,Curly,Psharp,BracketClose}{\}}\prebr{}
{\preindent{2}}\mdToken{Delimiter,Curly,Psharp,BracketClose}{\}}\prebr{}
\prebr{}
{\preindent{2}}\mdToken{Keyword,Psharp}{public}{\prespace{1}}\mdToken{Keyword,Psharp}{class}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{Program}{\prespace{1}}\mdToken{Delimiter,Curly,Psharp,BracketOpen}{\{}\prebr{}
{\preindent{4}}\mdToken{Keyword,Psharp}{static}{\prespace{1}}\mdToken{Keyword,Psharp}{void}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{Main}\mdToken{Delimiter,Parenthesis,Psharp,BracketOpen}{(}\mdToken{Keyword,Psharp}{string}\mdToken{Delimiter,Square,Psharp,BracketOpen}{[}\mdToken{Delimiter,Square,Psharp,BracketClose}{]}{\prespace{1}}\mdToken{Identifier,Psharp}{args}\mdToken{Delimiter,Parenthesis,Psharp,BracketClose}{)}{\prespace{1}}\mdToken{Delimiter,Curly,Psharp,BracketOpen}{\{}\prebr{}
{\preindent{6}}\mdToken{Type,Identifier,Psharp}{PSharpRuntime}\mdToken{Delimiter,Psharp}{.}\mdToken{Type,Identifier,Psharp}{CreateMachine}\mdToken{Delimiter,Parenthesis,Psharp,BracketOpen}{(}\mdToken{Keyword,Psharp}{typeof}\mdToken{Delimiter,Parenthesis,Psharp,BracketOpen}{(}\mdToken{Type,Identifier,Psharp}{Server}\mdToken{Delimiter,Parenthesis,Psharp,BracketClose}{)}\mdToken{Delimiter,Parenthesis,Psharp,BracketClose}{)}\mdToken{Delimiter,Psharp}{;}\prebr{}
{\preindent{6}}\mdToken{Type,Identifier,Psharp}{Console}\mdToken{Delimiter,Psharp}{.}\mdToken{Type,Identifier,Psharp}{ReadLine}\mdToken{Delimiter,Parenthesis,Psharp,BracketOpen}{(}\mdToken{Delimiter,Parenthesis,Psharp,BracketClose}{)}\mdToken{Delimiter,Psharp}{;}\prebr{}
{\preindent{4}}\mdToken{Delimiter,Curly,Psharp,BracketClose}{\}}\prebr{}
{\preindent{2}}\mdToken{Delimiter,Curly,Psharp,BracketClose}{\}}\prebr{}
\mdToken{Delimiter,Curly,Psharp,BracketClose}{\}}}%mdk
\end{mdPre}%mdk
\begin{mdP}[data-line={141}]%mdk
%mdk-data-line={141}
{}A %mdk-data-line={141}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Keyword,Psharp}{machine}}%mdk-data-line={141}
{} declaration contains a collection of field, state and method
declarations. For example, the machine %mdk-data-line={142}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{Server}}%mdk-data-line={142}
{} has a %mdk-data-line={142}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Identifier,Psharp}{client}}%mdk-data-line={142}
{} field, two states,
%mdk-data-line={143}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{Init}}%mdk-data-line={143}
{} and %mdk-data-line={143}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{Playing}}%mdk-data-line={143}
{}, and a method %mdk-data-line={143}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{SendPong}}%mdk-data-line={143}
{} declared inside it. The fields and
methods of a machine %mdk-data-line={144}
{}\mdEm{cannot}%mdk-data-line={144}
{} be public; they can only be accessed locally from a
particular instance of the machine. The %mdk-data-line={145}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Keyword,Psharp}{start}}%mdk-data-line={145}
{} modifier in the %mdk-data-line={145}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{Init}}%mdk-data-line={145}
{} state
declaration indicates that an instance of %mdk-data-line={146}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{Server}}%mdk-data-line={146}
{} begins executing by entering
the %mdk-data-line={147}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{Init}}%mdk-data-line={147}
{} state.%mdk
\end{mdP}%mdk
\begin{mdP}[class={indent},data-line={149}]%mdk
%mdk-data-line={149}
{}A %mdk-data-line={149}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Keyword,Psharp}{state}}%mdk-data-line={149}
{} declaration can optionally contain a number of state-specific declarations.
A code block indicated by %mdk-data-line={150}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Keyword,Psharp}{entry}}%mdk-data-line={150}
{} \{ %mdk-data-line={150}
{}{\dots}%mdk-data-line={150}
{} \} denotes an action that is executed when the
state is entered, while a code block indicated by %mdk-data-line={151}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Keyword,Psharp}{exit}}%mdk-data-line={151}
{} \{ %mdk-data-line={151}
{}{\dots}%mdk-data-line={151}
{} \} (not used in the
above example) denotes an action that is executed when the state exits.
A P%mdk-data-line={153}
{}\#%mdk-data-line={153}
{} action (e.g. %mdk-data-line={153}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Keyword,Psharp}{entry}}%mdk-data-line={153}
{} %mdk-data-line={153}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Keyword,Psharp}{exit}}%mdk-data-line={153}
{} and %mdk-data-line={153}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{SendPong}}%mdk-data-line={153}
{}), is a block of arbitrary P%mdk-data-line={153}
{}\#%mdk-data-line={153}
{} and
C%mdk-data-line={154}
{}\#%mdk-data-line={154}
{} statements. As an example, the %mdk-data-line={154}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Keyword,Psharp}{entry}}%mdk-data-line={154}
{} action in the state %mdk-data-line={154}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{Init}}%mdk-data-line={154}
{} of %mdk-data-line={154}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{Server}}%mdk-data-line={154}
{}
contains two statements.
The first statement, %mdk-data-line={156}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Keyword,Psharp}{this}\mdToken{Delimiter,Psharp}{.}\mdToken{Identifier,Psharp}{client}{\prespace{1}}\mdToken{Operator,Psharp}{=}{\prespace{1}}\mdToken{Keyword,Psharp}{create}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{Client}{\prespace{1}}\mdToken{Delimiter,Parenthesis,Psharp,BracketOpen}{(}{\prespace{1}}\mdToken{Keyword,Psharp}{this}{\prespace{1}}\mdToken{Delimiter,Parenthesis,Psharp,BracketClose}{)}}%mdk-data-line={156}
{}, creates a new instance
of the %mdk-data-line={157}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{Client}}%mdk-data-line={157}
{} machine and stores a reference to this instance in the field %mdk-data-line={157}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Identifier,Psharp}{client}}%mdk-data-line={157}
{}.
Note that P%mdk-data-line={158}
{}\#%mdk-data-line={158}
{} allows the use of all the primitive types that C%mdk-data-line={158}
{}\#%mdk-data-line={158}
{} provides (e.g. %mdk-data-line={158}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Keyword,Psharp}{int}}%mdk-data-line={158}
{}
and %mdk-data-line={159}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Keyword,Psharp}{bool}}%mdk-data-line={159}
{}) and also introduces the %mdk-data-line={159}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Keyword,Psharp}{machine}}%mdk-data-line={159}
{} type, which is a reference to a
dynamically-created P%mdk-data-line={160}
{}\#%mdk-data-line={160}
{} machine.
The second statement in the %mdk-data-line={161}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Keyword,Psharp}{entry}}%mdk-data-line={161}
{} action %mdk-data-line={161}
{}\mdEm{raises}%mdk-data-line={161}
{} an event %mdk-data-line={161}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{Unit}}%mdk-data-line={161}
{}, which causes
control to exit the %mdk-data-line={162}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{Init}}%mdk-data-line={162}
{} state and enter the %mdk-data-line={162}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{Playing}}%mdk-data-line={162}
{} state. When a machine raises
an event, it literally sends an event to itself.
In P%mdk-data-line={164}
{}\#%mdk-data-line={164}
{}, when a machine raises an event, or sends an event to another machine, the event
is enqueued in the target machine%mdk-data-line={165}
{}{'}%mdk-data-line={165}
{}s input queue. However, a raised event does not go
through the queue; rather it terminates execution of the enclosing code block and is
handled immediately.%mdk
\end{mdP}%mdk
\begin{mdP}[class={indent},data-line={169}]%mdk
%mdk-data-line={169}
{}Other than the %mdk-data-line={169}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Keyword,Psharp}{entry}}%mdk-data-line={169}
{} and %mdk-data-line={169}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Keyword,Psharp}{exit}}%mdk-data-line={169}
{} declarations, all other declarations inside a
state are related to event handling.
The declaration %mdk-data-line={171}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Keyword,Psharp}{on}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{Unit}{\prespace{1}}\mdToken{Keyword,Psharp}{goto}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{Playing}}%mdk-data-line={171}
{} in the state %mdk-data-line={171}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{Init}}%mdk-data-line={171}
{} of the %mdk-data-line={171}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{Server}}%mdk-data-line={171}
{} machine
is an example of such a declaration: it indicates that the %mdk-data-line={172}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{Unit}}%mdk-data-line={172}
{} event must be
handled by exiting the state %mdk-data-line={173}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{Init}}%mdk-data-line={173}
{} and transitioning to the state %mdk-data-line={173}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{Playing}}%mdk-data-line={173}
{}.
The declaration %mdk-data-line={174}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Keyword,Psharp}{on}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{Ping}{\prespace{1}}\mdToken{Keyword,Psharp}{do}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{SendPong}}%mdk-data-line={174}
{} in the state %mdk-data-line={174}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{Init}}%mdk-data-line={174}
{} of the %mdk-data-line={174}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{Server}}%mdk-data-line={174}
{} machine
is another example: it indicates that the %mdk-data-line={175}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{Ping}}%mdk-data-line={175}
{} event must be handled by invoking
the action %mdk-data-line={176}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{SendPong}}%mdk-data-line={176}
{}. P%mdk-data-line={176}
{}\#%mdk-data-line={176}
{} also supports %mdk-data-line={176}
{}\mdEm{anonymous}%mdk-data-line={176}
{} actions: the declaration
%mdk-data-line={177}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Keyword,Psharp}{on}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{Pong}{\prespace{1}}\mdToken{Keyword,Psharp}{do}}%mdk-data-line={177}
{} \{ %mdk-data-line={177}
{}{\dots}%mdk-data-line={177}
{} \} in the state %mdk-data-line={177}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{Playing}}%mdk-data-line={177}
{} of the %mdk-data-line={177}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{Client}}%mdk-data-line={177}
{} machine is such an
anonymous action, which states that the code block between the braces must be
executed when %mdk-data-line={179}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{Pong}}%mdk-data-line={179}
{} is dequeued. When an action executes control remains in the
state subsequent to this execution. This control primitive is useful for executing
an event-driven loop in a state, such as the one in %mdk-data-line={181}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{Playing}}%mdk-data-line={181}
{} for collecting
%mdk-data-line={182}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{Pong}}%mdk-data-line={182}
{} responses. Different states of a machine can choose to handle a particular
event in a different way: the programmer is free to decide how an event should be
handled.%mdk
\end{mdP}%mdk
\begin{mdP}[class={indent},data-line={186}]%mdk
%mdk-data-line={186}
{}A P%mdk-data-line={186}
{}\#%mdk-data-line={186}
{} action can be any C%mdk-data-line={186}
{}\#%mdk-data-line={186}
{} method that has no parameters. An example of an action is
%mdk-data-line={187}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{SendPong}}%mdk-data-line={187}
{}, which contains the %mdk-data-line={187}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Keyword,Psharp}{send}}%mdk-data-line={187}
{} statement that is responsible for sending
an event (in this case %mdk-data-line={188}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{Pong}}%mdk-data-line={188}
{}) to the machine whose address is stored in the field
%mdk-data-line={189}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Identifier,Psharp}{client}}%mdk-data-line={189}
{}. The keyword %mdk-data-line={189}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Keyword,Psharp}{this}}%mdk-data-line={189}
{} refers to the current instance of the machine (in this
case an instance of the %mdk-data-line={190}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{Server}}%mdk-data-line={190}
{} machine).%mdk
\end{mdP}%mdk
\begin{mdP}[class={indent},data-line={192}]%mdk
%mdk-data-line={192}
{}A machine can optionally send data to another machine, either when creating a machine
(via the %mdk-data-line={193}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Keyword,Psharp}{create}}%mdk-data-line={193}
{} statement) or when sending an event to a machine (via the %mdk-data-line={193}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Keyword,Psharp}{send}}%mdk-data-line={193}
{}
statement). Note that both %mdk-data-line={194}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Keyword,Psharp}{create}}%mdk-data-line={194}
{} and %mdk-data-line={194}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Keyword,Psharp}{send}}%mdk-data-line={194}
{} statements are non-blocking.
In the above example, the %mdk-data-line={195}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{Server}}%mdk-data-line={195}
{} machine sends a reference to itself (i.e. %mdk-data-line={195}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Keyword,Psharp}{this}}%mdk-data-line={195}
{})
when creating the %mdk-data-line={196}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{Client}}%mdk-data-line={196}
{} machine in the %mdk-data-line={196}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Keyword,Psharp}{entry}}%mdk-data-line={196}
{} action of the %mdk-data-line={196}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{Init}}%mdk-data-line={196}
{} state. The
%mdk-data-line={197}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{Client}}%mdk-data-line={197}
{} machine can retrieve this data by using the keyword %mdk-data-line={197}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Keyword,Psharp}{payload}}%mdk-data-line={197}
{}, as in the
%mdk-data-line={198}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Keyword,Psharp}{entry}}%mdk-data-line={198}
{} action of the state %mdk-data-line={198}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{Init}}%mdk-data-line={198}
{}. When a machine receives a %mdk-data-line={198}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Keyword,Psharp}{payload}}%mdk-data-line={198}
{} it has to
cast the data to its expected type; in this case the %mdk-data-line={199}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Keyword,Psharp}{machine}}%mdk-data-line={199}
{} type (as it is a
reference to the %mdk-data-line={200}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{Server}}%mdk-data-line={200}
{} machine).%mdk
\end{mdP}%mdk
\begin{mdP}[class={indent},data-line={202}]%mdk
%mdk-data-line={202}
{}To start execution of a P%mdk-data-line={202}
{}\#%mdk-data-line={202}
{} program, the programmer has to create an initial machine
using the %mdk-data-line={203}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{CreateMachine}}%mdk-data-line={203}
{} method provided by the %mdk-data-line={203}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{PSharpRuntime}}%mdk-data-line={203}
{} API. This method
accepts as a parameter the type of the machine to be created (in our case a %mdk-data-line={204}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{Server}}%mdk-data-line={204}
{}
machine) and an optional payload (not used in the above example). Because the
%mdk-data-line={206}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{CreateMachine}}%mdk-data-line={206}
{} method is non-blocking, we use the %mdk-data-line={206}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{Console}\mdToken{Delimiter,Psharp}{.}\mdToken{Type,Identifier,Psharp}{ReadLine}\mdToken{Delimiter,Parenthesis,Psharp,BracketOpen}{(}\mdToken{Delimiter,Parenthesis,Psharp,BracketClose}{)}}%mdk-data-line={206}
{} statement
so that the program does not exit prematurely. The %mdk-data-line={207}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{PSharpRuntime}}%mdk-data-line={207}
{} API also provides
a method for enqueueing events to a P%mdk-data-line={208}
{}\#%mdk-data-line={208}
{} machine from C%mdk-data-line={208}
{}\#%mdk-data-line={208}
{} code (not used in the above
example). To do this, the programmer has to use the %mdk-data-line={209}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{SendEvent}}%mdk-data-line={209}
{} method that accepts
as a parameter a %mdk-data-line={210}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{MachineId}}%mdk-data-line={210}
{} object, returned when creating a machine via the
%mdk-data-line={211}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{CreateMachine}}%mdk-data-line={211}
{} method, and an event object.%mdk
\end{mdP}%mdk
\begin{mdP}[class={indent},data-line={213}]%mdk
%mdk-data-line={213}
{}In the above example, the P%mdk-data-line={213}
{}\#%mdk-data-line={213}
{} program begins with a single instance of %mdk-data-line={213}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{Server}}%mdk-data-line={213}
{} being
created and then entering state %mdk-data-line={214}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{Init}}%mdk-data-line={214}
{}. Let us call this instance of the Server
machine %mdk-data-line={215}
{}\mdEm{server}%mdk-data-line={215}
{}. Machine %mdk-data-line={215}
{}\mdEm{server}%mdk-data-line={215}
{} then creates an instance of the %mdk-data-line={215}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{Client}}%mdk-data-line={215}
{} machine
and raises the event %mdk-data-line={216}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{Unit}}%mdk-data-line={216}
{} to enter the state %mdk-data-line={216}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{Playing}}%mdk-data-line={216}
{}. Let us call this instance
of the %mdk-data-line={217}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{Client}}%mdk-data-line={217}
{} machine %mdk-data-line={217}
{}\mdEm{client}%mdk-data-line={217}
{}. The machine %mdk-data-line={217}
{}\mdEm{client}%mdk-data-line={217}
{} begins execution when %mdk-data-line={217}
{}\mdEm{server}%mdk-data-line={217}
{}
is in the state %mdk-data-line={218}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{Playing}}%mdk-data-line={218}
{}, then %mdk-data-line={218}
{}\mdEm{client}%mdk-data-line={218}
{} also transitions to the state %mdk-data-line={218}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{Playing}}%mdk-data-line={218}
{} by
raising a event %mdk-data-line={219}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{Unit}}%mdk-data-line={219}
{}. From this point on, %mdk-data-line={219}
{}\mdEm{client}%mdk-data-line={219}
{} and %mdk-data-line={219}
{}\mdEm{server}%mdk-data-line={219}
{} exchange %mdk-data-line={219}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{Ping}}%mdk-data-line={219}
{}
and %mdk-data-line={220}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{Pong}}%mdk-data-line={220}
{} events.%mdk
\end{mdP}%mdk
\begin{mdP}[class={indent},data-line={222}]%mdk
%mdk-data-line={222}
{}The most important safety specification of a P%mdk-data-line={222}
{}\#%mdk-data-line={222}
{} program is that every event dequeued
by a machine is handled; otherwise, the P%mdk-data-line={223}
{}\#%mdk-data-line={223}
{} runtime reports an unhandled event error.
The PingPong program satisfies this specification since the %mdk-data-line={224}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{Server}}%mdk-data-line={224}
{} machine handles
the %mdk-data-line={225}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{Ping}}%mdk-data-line={225}
{} event and the %mdk-data-line={225}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{Client}}%mdk-data-line={225}
{} machine handles the %mdk-data-line={225}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{Pong}}%mdk-data-line={225}
{} event in every state
where an event dequeue is possible.%mdk
\end{mdP}%mdk
\begin{mdP}[class={indent},data-line={228}]%mdk
%mdk-data-line={228}
{}In order to terminate a P%mdk-data-line={228}
{}\#%mdk-data-line={228}
{} machine cleanly, it must dequeue a special %mdk-data-line={228}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Keyword,Psharp}{halt}}%mdk-data-line={228}
{} event.
In this example, after %mdk-data-line={229}
{}\mdEm{client}%mdk-data-line={229}
{} sends 5 %mdk-data-line={229}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{Ping}}%mdk-data-line={229}
{} events to %mdk-data-line={229}
{}\mdEm{server}%mdk-data-line={229}
{}, it sends %mdk-data-line={229}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Keyword,Psharp}{halt}}%mdk-data-line={229}
{}
to %mdk-data-line={230}
{}\mdEm{server}%mdk-data-line={230}
{} and then raises %mdk-data-line={230}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Keyword,Psharp}{halt}}%mdk-data-line={230}
{}.
Termination of a machine due to an unhandled %mdk-data-line={231}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Keyword,Psharp}{halt}}%mdk-data-line={231}
{} event is valid behavior (the P%mdk-data-line={231}
{}\#%mdk-data-line={231}
{}
runtime does not report an error).
From the point of view of formal operational semantics, a halted machine is fully
receptive and consumes any event that is sent to it.
The P%mdk-data-line={235}
{}\#%mdk-data-line={235}
{} runtime implements this semantics efficiently by cleaning up resources
allocated to a halted machine and recording that the machine has halted.
An event sent to a halted machine is simply dropped.
A halted machine cannot be restarted; it remains halted forever.%mdk
\end{mdP}%mdk
\mdHxx[id=sec-advanced-features,label={[3]\{.heading-label\}},toc={},font-weight={normal},data-line={240},caption={[[3]\{.heading-label\}.{\hspace*{0.5em}}]\{.heading-before\}Advanced P\# features},bookmark={3.{\hspace*{0.5em}}Advanced P\# features}]{%mdk-data-line={240}
{}\mdSpan[class={heading-before}]{\mdSpan[class={heading-label}]{3}.{\hspace*{0.5em}}}%mdk-data-line={240}
{}Advanced P%mdk-data-line={240}
{}\#%mdk-data-line={240}
{} features}\begin{mdP}[data-line={242}]%mdk
%mdk-data-line={242}
{}The following example illustrates the more advanced features of the P%mdk-data-line={242}
{}\#%mdk-data-line={242}
{} language.
This program implements a failure detection protocol. A %mdk-data-line={243}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{FailureDetector}}%mdk-data-line={243}
{} machine
is given a list of machines, each of which represents a daemon running at a node of
a distributed system. The %mdk-data-line={245}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{FailureDetector}}%mdk-data-line={245}
{} sends each machine in the list a %mdk-data-line={245}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{Ping}}%mdk-data-line={245}
{}
event and determines whether a machine has failed. A machine has failed if it does
not respond with a %mdk-data-line={247}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{Pong}}%mdk-data-line={247}
{} event within a certain time period. The %mdk-data-line={247}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{FailureDetector}}%mdk-data-line={247}
{}
uses an operating system timer to implement the bounded wait for the %mdk-data-line={248}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{Pong}}%mdk-data-line={248}
{} event.%mdk
\end{mdP}%mdk
\mdHxxx[id=sec-modeling-a-machine,label={[3.1]\{.heading-label\}},toc={},font-weight={normal},data-line={250},caption={[[3.1]\{.heading-label\}.{\hspace*{0.5em}}]\{.heading-before\}Modeling a machine},bookmark={3.1.{\hspace*{0.5em}}Modeling a machine}]{%mdk-data-line={250}
{}\mdSpan[class={heading-before}]{\mdSpan[class={heading-label}]{3.1}.{\hspace*{0.5em}}}%mdk-data-line={250}
{}Modeling a machine}\begin{mdP}[data-line={252}]%mdk
%mdk-data-line={252}
{}The code snippet below shows the implementation of the %mdk-data-line={252}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{Timer}}%mdk-data-line={252}
{} machine. This machine
is declared using the keyword %mdk-data-line={253}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Keyword,Psharp}{model}}%mdk-data-line={253}
{} (instead of %mdk-data-line={253}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Keyword,Psharp}{machine}}%mdk-data-line={253}
{}) to indicate that it
represents an abstraction of the operating system (OS) timer. This abstraction
%mdk-data-line={255}
{}\mdEm{substitutes}%mdk-data-line={255}
{} the OS timer and is used to %mdk-data-line={255}
{}\mdEm{systematically test}%mdk-data-line={255}
{} the interaction of the
failure detector protocol with the underlying OS (see Section%mdk-data-line={256}
{}{\mdNbsp}\mdA[class={localref},target-element={h1}]{sec-tools}{}{\mdSpan[class={heading-label}]{4}}%mdk-data-line={256}
{}).
During execution of a P%mdk-data-line={257}
{}\#%mdk-data-line={257}
{} program, model machines are %mdk-data-line={257}
{}\mdEm{replaced}%mdk-data-line={257}
{} by their actual
implementations; a model machine is used only for systematic testing.%mdk
\end{mdP}%mdk
\begin{mdPre}[class={para-block,pre-fenced,pre-fenced3,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp},data-line={260},data-line-code={261}]%mdk
\mdPrecode[data-line={261}]{\mdToken{Comment,Psharp}{//\prespace{1}Timer.psharp}\prebr{}
\mdToken{Keyword,Psharp}{namespace}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{FailureDetector}{\prespace{1}}\mdToken{Delimiter,Curly,Psharp,BracketOpen}{\{}\prebr{}
{\preindent{2}}\mdToken{Comment,Psharp}{//\prespace{1}events\prespace{1}from\prespace{1}client\prespace{1}to\prespace{1}timer}\prebr{}
{\preindent{2}}\mdToken{Keyword,Psharp}{event}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{Start}\mdToken{Delimiter,Psharp}{;}\prebr{}
{\preindent{2}}\mdToken{Keyword,Psharp}{event}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{Cancel}\mdToken{Delimiter,Psharp}{;}\prebr{}
{\preindent{2}}\mdToken{Comment,Psharp}{//\prespace{1}events\prespace{1}from\prespace{1}timer\prespace{1}to\prespace{1}client}\prebr{}
{\preindent{2}}\mdToken{Keyword,Psharp}{event}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{Timeout}\mdToken{Delimiter,Psharp}{;}\prebr{}
{\preindent{2}}\mdToken{Keyword,Psharp}{event}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{CancelSuccess}\mdToken{Delimiter,Psharp}{;}\prebr{}
{\preindent{2}}\mdToken{Keyword,Psharp}{event}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{CancelFailure}\mdToken{Delimiter,Psharp}{;}\prebr{}
{\preindent{2}}\mdToken{Comment,Psharp}{//\prespace{1}local\prespace{1}event\prespace{1}for\prespace{1}control\prespace{1}transfer\prespace{1}within\prespace{1}timer}\prebr{}
{\preindent{2}}\mdToken{Keyword,Psharp}{event}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{Unit}\mdToken{Delimiter,Psharp}{;}\prebr{}
\prebr{}
{\preindent{2}}\mdToken{Keyword,Psharp}{model}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{Timer}{\prespace{1}}\mdToken{Delimiter,Curly,Psharp,BracketOpen}{\{}\prebr{}
{\preindent{4}}\mdToken{Keyword,Psharp}{machine}{\prespace{1}}\mdToken{Identifier,Psharp}{client}\mdToken{Delimiter,Psharp}{;}\prebr{}
{\preindent{4}}\prebr{}
{\preindent{4}}\mdToken{Keyword,Psharp}{start}{\prespace{1}}\mdToken{Keyword,Psharp}{state}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{Init}{\prespace{1}}\mdToken{Delimiter,Curly,Psharp,BracketOpen}{\{}\prebr{}
{\preindent{6}}\mdToken{Keyword,Psharp}{entry}{\prespace{1}}\mdToken{Delimiter,Curly,Psharp,BracketOpen}{\{}\prebr{}
{\preindent{8}}\mdToken{Keyword,Psharp}{this}\mdToken{Delimiter,Psharp}{.}\mdToken{Identifier,Psharp}{client}{\prespace{1}}\mdToken{Operator,Psharp}{=}{\prespace{1}}\mdToken{Delimiter,Parenthesis,Psharp,BracketOpen}{(}\mdToken{Keyword,Psharp}{machine}\mdToken{Delimiter,Parenthesis,Psharp,BracketClose}{)}\mdToken{Keyword,Psharp}{payload}\mdToken{Delimiter,Psharp}{;}\prebr{}
{\preindent{8}}\mdToken{Keyword,Psharp}{raise}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{Unit}\mdToken{Delimiter,Psharp}{;}{\prespace{1}}\mdToken{Comment,Psharp}{//\prespace{1}goto\prespace{1}handler\prespace{1}of\prespace{1}Unit}\prebr{}
{\preindent{6}}\mdToken{Delimiter,Curly,Psharp,BracketClose}{\}}\prebr{}
{\preindent{8}}\prebr{}
{\preindent{6}}\mdToken{Keyword,Psharp}{on}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{Unit}{\prespace{1}}\mdToken{Keyword,Psharp}{goto}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{WaitForReq}\mdToken{Delimiter,Psharp}{;}\prebr{}
{\preindent{4}}\mdToken{Delimiter,Curly,Psharp,BracketClose}{\}}\prebr{}
\prebr{}
{\preindent{4}}\mdToken{Keyword,Psharp}{state}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{WaitForReq}{\prespace{1}}\mdToken{Delimiter,Curly,Psharp,BracketOpen}{\{}\prebr{}
{\preindent{6}}\mdToken{Keyword,Psharp}{on}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{Cancel}{\prespace{1}}\mdToken{Keyword,Psharp}{goto}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{WaitForReq}{\prespace{1}}\mdToken{Keyword,Psharp}{with}{\prespace{1}}\mdToken{Delimiter,Curly,Psharp,BracketOpen}{\{}\prebr{}
{\preindent{8}}\mdToken{Keyword,Psharp}{send}{\prespace{1}}\mdToken{Keyword,Psharp}{this}\mdToken{Delimiter,Psharp}{.}\mdToken{Identifier,Psharp}{client}\mdToken{Delimiter,Psharp}{,}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{CancelFailure}{\prespace{1}}\mdToken{Delimiter,Parenthesis,Psharp,BracketOpen}{(}{\prespace{1}}\mdToken{Keyword,Psharp}{this}{\prespace{1}}\mdToken{Delimiter,Parenthesis,Psharp,BracketClose}{)}\mdToken{Delimiter,Psharp}{;}\prebr{}
{\preindent{6}}\mdToken{Delimiter,Curly,Psharp,BracketClose}{\}}\mdToken{Delimiter,Psharp}{;}\prebr{}
{\preindent{6}}\prebr{}
{\preindent{6}}\mdToken{Keyword,Psharp}{on}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{Start}{\prespace{1}}\mdToken{Keyword,Psharp}{goto}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{WaitForCancel}\mdToken{Delimiter,Psharp}{;}\prebr{}
{\preindent{4}}\mdToken{Delimiter,Curly,Psharp,BracketClose}{\}}\prebr{}
\prebr{}
{\preindent{4}}\mdToken{Keyword,Psharp}{state}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{WaitForCancel}{\prespace{1}}\mdToken{Delimiter,Curly,Psharp,BracketOpen}{\{}\prebr{}
{\preindent{6}}\mdToken{Keyword,Psharp}{ignore}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{Start}\mdToken{Delimiter,Psharp}{;}\prebr{}
{\preindent{6}}\prebr{}
{\preindent{6}}\mdToken{Keyword,Psharp}{on}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{Cancel}{\prespace{1}}\mdToken{Keyword,Psharp}{goto}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{WaitForReq}{\prespace{1}}\mdToken{Keyword,Psharp}{with}{\prespace{1}}\mdToken{Delimiter,Curly,Psharp,BracketOpen}{\{}\prebr{}
{\preindent{8}}\mdToken{Keyword,Psharp}{if}{\prespace{1}}\mdToken{Delimiter,Parenthesis,Psharp,BracketOpen}{(}\mdToken{Identifier,Psharp}{\$}\mdToken{Delimiter,Parenthesis,Psharp,BracketClose}{)}{\prespace{1}}\mdToken{Delimiter,Curly,Psharp,BracketOpen}{\{}\prebr{}
{\preindent{10}}\mdToken{Keyword,Psharp}{send}{\prespace{1}}\mdToken{Keyword,Psharp}{this}\mdToken{Delimiter,Psharp}{.}\mdToken{Identifier,Psharp}{client}\mdToken{Delimiter,Psharp}{,}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{CancelSuccess}{\prespace{1}}\mdToken{Delimiter,Parenthesis,Psharp,BracketOpen}{(}{\prespace{1}}\mdToken{Keyword,Psharp}{this}{\prespace{1}}\mdToken{Delimiter,Parenthesis,Psharp,BracketClose}{)}\mdToken{Delimiter,Psharp}{;}\prebr{}
{\preindent{8}}\mdToken{Delimiter,Curly,Psharp,BracketClose}{\}}{\prespace{1}}\mdToken{Keyword,Psharp}{else}{\prespace{1}}\mdToken{Delimiter,Curly,Psharp,BracketOpen}{\{}\prebr{}
{\preindent{10}}\mdToken{Keyword,Psharp}{send}{\prespace{1}}\mdToken{Keyword,Psharp}{this}\mdToken{Delimiter,Psharp}{.}\mdToken{Identifier,Psharp}{client}\mdToken{Delimiter,Psharp}{,}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{CancelFailure}{\prespace{1}}\mdToken{Delimiter,Parenthesis,Psharp,BracketOpen}{(}{\prespace{1}}\mdToken{Keyword,Psharp}{this}{\prespace{1}}\mdToken{Delimiter,Parenthesis,Psharp,BracketClose}{)}\mdToken{Delimiter,Psharp}{;}\prebr{}
{\preindent{10}}\mdToken{Keyword,Psharp}{send}{\prespace{1}}\mdToken{Keyword,Psharp}{this}\mdToken{Delimiter,Psharp}{.}\mdToken{Identifier,Psharp}{client}\mdToken{Delimiter,Psharp}{,}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{Timeout}{\prespace{1}}\mdToken{Delimiter,Parenthesis,Psharp,BracketOpen}{(}{\prespace{1}}\mdToken{Keyword,Psharp}{this}{\prespace{1}}\mdToken{Delimiter,Parenthesis,Psharp,BracketClose}{)}\mdToken{Delimiter,Psharp}{;}\prebr{}
{\preindent{8}}\mdToken{Delimiter,Curly,Psharp,BracketClose}{\}}\prebr{}
{\preindent{6}}\mdToken{Delimiter,Curly,Psharp,BracketClose}{\}}\mdToken{Delimiter,Psharp}{;}\prebr{}
{\preindent{6}}\prebr{}
{\preindent{6}}\mdToken{Keyword,Psharp}{on}{\prespace{1}}\mdToken{Keyword,Psharp}{default}{\prespace{1}}\mdToken{Keyword,Psharp}{goto}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{WaitForReq}{\prespace{1}}\mdToken{Keyword,Psharp}{with}{\prespace{1}}\mdToken{Delimiter,Curly,Psharp,BracketOpen}{\{}\prebr{}
{\preindent{10}}\mdToken{Keyword,Psharp}{send}{\prespace{1}}\mdToken{Keyword,Psharp}{this}\mdToken{Delimiter,Psharp}{.}\mdToken{Identifier,Psharp}{client}\mdToken{Delimiter,Psharp}{,}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{Timeout}{\prespace{1}}\mdToken{Delimiter,Parenthesis,Psharp,BracketOpen}{(}{\prespace{1}}\mdToken{Keyword,Psharp}{this}{\prespace{1}}\mdToken{Delimiter,Parenthesis,Psharp,BracketClose}{)}\mdToken{Delimiter,Psharp}{;}\prebr{}
{\preindent{6}}\mdToken{Delimiter,Curly,Psharp,BracketClose}{\}}\mdToken{Delimiter,Psharp}{;}\prebr{}
{\preindent{4}}\mdToken{Delimiter,Curly,Psharp,BracketClose}{\}}\prebr{}
{\preindent{2}}\mdToken{Delimiter,Curly,Psharp,BracketClose}{\}}\prebr{}
\mdToken{Delimiter,Curly,Psharp,BracketClose}{\}}}%mdk
\end{mdPre}%mdk
\begin{mdP}[data-line={313}]%mdk
%mdk-data-line={313}
{}Each instance of a %mdk-data-line={313}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{Timer}}%mdk-data-line={313}
{} machine has a reference to a %mdk-data-line={313}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{Client}}%mdk-data-line={313}
{} machine instance,
stored in the %mdk-data-line={314}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Identifier,Psharp}{client}}%mdk-data-line={314}
{} field. This client sends %mdk-data-line={314}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{Start}}%mdk-data-line={314}
{} and %mdk-data-line={314}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{Cancel}}%mdk-data-line={314}
{} events to the
timer, which subsequently responds with %mdk-data-line={315}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{Timeout}}%mdk-data-line={315}
{}, %mdk-data-line={315}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{CancelSuccess}}%mdk-data-line={315}
{}, or %mdk-data-line={315}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{CancelFailure}}%mdk-data-line={315}
{}
events.%mdk
\end{mdP}%mdk
\begin{mdP}[class={indent},data-line={318}]%mdk
%mdk-data-line={318}
{}The timer has three states: %mdk-data-line={318}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{Init}}%mdk-data-line={318}
{}, %mdk-data-line={318}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{WaitForReq}}%mdk-data-line={318}
{} and %mdk-data-line={318}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{WaitForCancel}}%mdk-data-line={318}
{}. It starts
executing in the state %mdk-data-line={319}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{Init}}%mdk-data-line={319}
{}, where it initializes the %mdk-data-line={319}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Identifier,Psharp}{client}}%mdk-data-line={319}
{} field with the
machine reference obtained by accessing %mdk-data-line={320}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Keyword,Psharp}{payload}}%mdk-data-line={320}
{} and casting it to the type
%mdk-data-line={321}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Keyword,Psharp}{machine}}%mdk-data-line={321}
{}. It then waits in the state %mdk-data-line={321}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{WaitForReq}}%mdk-data-line={321}
{} for a request from the client,
responding with %mdk-data-line={322}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{CancelFailure}}%mdk-data-line={322}
{} to a %mdk-data-line={322}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{Cancel}}%mdk-data-line={322}
{} event and moving to the %mdk-data-line={322}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{WaitForCancel}}%mdk-data-line={322}
{}
state on a %mdk-data-line={323}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{Start}}%mdk-data-line={323}
{} event.%mdk
\end{mdP}%mdk
\begin{mdP}[class={indent},data-line={325}]%mdk
%mdk-data-line={325}
{}The %mdk-data-line={325}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Keyword,Psharp}{ignore}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{Start}}%mdk-data-line={325}
{} declaration inside the %mdk-data-line={325}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{WaitForCancel}}%mdk-data-line={325}
{} state of the timer denotes
that whenever the event %mdk-data-line={326}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{Start}}%mdk-data-line={326}
{} is dequeued it must be dropped without taking any
further action.%mdk
\end{mdP}%mdk
\begin{mdP}[class={indent},data-line={329}]%mdk
%mdk-data-line={329}
{}The response to a %mdk-data-line={329}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{Cancel}}%mdk-data-line={329}
{} event involves the use of nondeterminism to model the
race condition between the arrival of a %mdk-data-line={330}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{Cancel}}%mdk-data-line={330}
{} event from the client and the
elapse of the timer. This nondeterminism is indicated by an %mdk-data-line={331}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Keyword,Psharp}{if}}%mdk-data-line={331}
{} statement guarded
by the keyword %mdk-data-line={332}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Identifier,Psharp}{\$}}%mdk-data-line={332}
{}, which returns a nondeterminitic boolean choice.
The then-branch models the case when the %mdk-data-line={333}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{Cancel}}%mdk-data-line={333}
{} event arrives before the timer
elapses; in this case, %mdk-data-line={334}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{CancelSuccess}}%mdk-data-line={334}
{} is sent back to the client.
The else-branch models the case when the timer fires before the %mdk-data-line={335}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{Cancel}}%mdk-data-line={335}
{} event
arrives; in this case, %mdk-data-line={336}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{CancelFailure}}%mdk-data-line={336}
{} and %mdk-data-line={336}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{Timeout}}%mdk-data-line={336}
{} are sent back to the client
one after another. The last event handler %mdk-data-line={337}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Keyword,Psharp}{on}{\prespace{1}}\mdToken{Keyword,Psharp}{default}{\prespace{1}}\mdToken{Keyword,Psharp}{goto}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{WaitForReq}{\prespace{1}}\mdToken{Keyword,Psharp}{with}{\prespace{1}}\mdToken{Delimiter,Curly,Psharp,BracketOpen}{\{}{\prespace{1}}\mdToken{Delimiter,Psharp}{.}\mdToken{Delimiter,Psharp}{.}\mdToken{Delimiter,Psharp}{.}{\prespace{1}}\mdToken{Delimiter,Curly,Psharp,BracketClose}{\}}}%mdk-data-line={337}
{}
transfers the control to the %mdk-data-line={338}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{WaitForReq}}%mdk-data-line={338}
{} state, modeling that the timer has elapsed,
if neither of the other event handlers in %mdk-data-line={339}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{WaitForCancel}}%mdk-data-line={339}
{} can execute. The %mdk-data-line={339}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Keyword,Psharp}{with}}%mdk-data-line={339}
{}
statement block executes after the %mdk-data-line={340}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Keyword,Psharp}{exit}}%mdk-data-line={340}
{} action of the exiting state.
The event %mdk-data-line={341}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Keyword,Psharp}{default}}%mdk-data-line={341}
{} is a special event that is internally generated by the P%mdk-data-line={341}
{}\#%mdk-data-line={341}
{}
runtime.%mdk
\end{mdP}%mdk
\mdHxxx[id=sec-substitution,label={[3.2]\{.heading-label\}},toc={},font-weight={normal},data-line={344},caption={[[3.2]\{.heading-label\}.{\hspace*{0.5em}}]\{.heading-before\}Substitution},bookmark={3.2.{\hspace*{0.5em}}Substitution}]{%mdk-data-line={344}
{}\mdSpan[class={heading-before}]{\mdSpan[class={heading-label}]{3.2}.{\hspace*{0.5em}}}%mdk-data-line={344}
{}Substitution}\begin{mdP}[data-line={346}]%mdk
%mdk-data-line={346}
{}A machine can be used to model another machine for systematic testing, using the
%mdk-data-line={347}
{}\mdEm{substitution}%mdk-data-line={347}
{} feature of the P%mdk-data-line={347}
{}\#%mdk-data-line={347}
{} language. To achieve this, the programmer has to use
the following special create statement:%mdk
\end{mdP}%mdk
\begin{mdPre}[class={para-block,pre-fenced,pre-fenced3,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp},data-line={350},data-line-code={351}]%mdk
\mdPrecode[data-line={351}]{\mdToken{Keyword,Psharp}{create}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{Foo}{\prespace{1}}\mdToken{Delimiter,Parenthesis,Psharp,BracketOpen}{(}\mdToken{Delimiter,Parenthesis,Psharp,BracketClose}{)}{\prespace{1}}\mdToken{Identifier,Psharp}{models}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{Bar}\mdToken{Delimiter,Psharp}{;}}%mdk
\end{mdPre}%mdk
\begin{mdP}[data-line={354}]%mdk
%mdk-data-line={354}
{}In this case, the %mdk-data-line={354}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{Foo}}%mdk-data-line={354}
{} machine is used to model the Bar machine. During systematic testing,
the %mdk-data-line={355}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{Foo}}%mdk-data-line={355}
{} machine will be created, whereas during real execution, the %mdk-data-line={355}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{Bar}}%mdk-data-line={355}
{} machine will be
created.%mdk
\end{mdP}%mdk
\begin{mdP}[class={indent},data-line={358}]%mdk
%mdk-data-line={358}
{}Likewise, a method can model another method for systematic testing. The concept behind this
is similar to how a machine can model another machine. The following special call statement
can be used:%mdk
\end{mdP}%mdk
\begin{mdPre}[class={para-block,pre-fenced,pre-fenced3,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp},data-line={362},data-line-code={363}]%mdk
\mdPrecode[data-line={363}]{\mdToken{Type,Identifier,Psharp}{Foo}\mdToken{Delimiter,Parenthesis,Psharp,BracketOpen}{(}\mdToken{Delimiter,Parenthesis,Psharp,BracketClose}{)}{\prespace{1}}\mdToken{Keyword,Psharp}{for}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{Bar}\mdToken{Delimiter,Psharp}{;}}%mdk
\end{mdPre}%mdk
\begin{mdP}[data-line={366}]%mdk
%mdk-data-line={366}
{}In this case, the %mdk-data-line={366}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{Foo}}%mdk-data-line={366}
{} method will be called instead of the %mdk-data-line={366}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{Bar}}%mdk-data-line={366}
{} method during systematic
testing, wheras the %mdk-data-line={367}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{Bar}}%mdk-data-line={367}
{} method will be called during real execution.%mdk
\end{mdP}%mdk
\mdHxxx[id=sec-failure-detection-protocol,label={[3.3]\{.heading-label\}},toc={},font-weight={normal},data-line={369},caption={[[3.3]\{.heading-label\}.{\hspace*{0.5em}}]\{.heading-before\}Failure detection protocol},bookmark={3.3.{\hspace*{0.5em}}Failure detection protocol}]{%mdk-data-line={369}
{}\mdSpan[class={heading-before}]{\mdSpan[class={heading-label}]{3.3}.{\hspace*{0.5em}}}%mdk-data-line={369}
{}Failure detection protocol}\begin{mdP}[data-line={371}]%mdk
%mdk-data-line={371}
{}The failure detection protocol is based on the interaction of two types of machines,
%mdk-data-line={372}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{FailureDetector}}%mdk-data-line={372}
{} and %mdk-data-line={372}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{Node}}%mdk-data-line={372}
{}, which are shown below. The code of the %mdk-data-line={372}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{FailureDetector}}%mdk-data-line={372}
{}
machine presents advanced features of P%mdk-data-line={373}
{}\#%mdk-data-line={373}
{}, including %mdk-data-line={373}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Keyword,Psharp}{push}}%mdk-data-line={373}
{} transitions and %mdk-data-line={373}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Keyword,Psharp}{pop}}%mdk-data-line={373}
{}
statements, deferred events, and monitors.%mdk
\end{mdP}%mdk
\begin{mdPre}[class={para-block,pre-fenced,pre-fenced3,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp},data-line={376},data-line-code={377}]%mdk
\mdPrecode[data-line={377}]{\mdToken{Comment,Psharp}{//\prespace{1}FailureDetector.psharp}\prebr{}
\mdToken{Keyword,Psharp}{namespace}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{FailureDetector}{\prespace{1}}\mdToken{Delimiter,Curly,Psharp,BracketOpen}{\{}\prebr{}
{\preindent{2}}\mdToken{Comment,Psharp}{//\prespace{1}request\prespace{1}from\prespace{1}failure\prespace{1}detector\prespace{1}to\prespace{1}node}\prebr{}
{\preindent{2}}\mdToken{Keyword,Psharp}{event}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{Ping}\mdToken{Delimiter,Psharp}{;}\prebr{}
{\preindent{2}}\mdToken{Comment,Psharp}{//\prespace{1}response\prespace{1}from\prespace{1}node\prespace{1}to\prespace{1}failure\prespace{1}detector}\prebr{}
{\preindent{2}}\mdToken{Keyword,Psharp}{event}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{Pong}\mdToken{Delimiter,Psharp}{;}\prebr{}
{\preindent{2}}\mdToken{Comment,Psharp}{//\prespace{1}register\prespace{1}a\prespace{1}client\prespace{1}for\prespace{1}failure\prespace{1}notification}\prebr{}
{\preindent{2}}\mdToken{Keyword,Psharp}{event}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{RegisterClient}\mdToken{Delimiter,Psharp}{;}\prebr{}
{\preindent{2}}\mdToken{Comment,Psharp}{//\prespace{1}unregister\prespace{1}a\prespace{1}client\prespace{1}from\prespace{1}failure\prespace{1}notification}\prebr{}
{\preindent{2}}\mdToken{Keyword,Psharp}{event}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{UnregisterClient}\mdToken{Delimiter,Psharp}{;}\prebr{}
{\preindent{2}}\mdToken{Comment,Psharp}{//\prespace{1}local\prespace{1}events\prespace{1}for\prespace{1}control\prespace{1}transfer\prespace{1}within\prespace{1}failure\prespace{1}detector}\prebr{}
{\preindent{2}}\mdToken{Keyword,Psharp}{event}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{RoundDone}\mdToken{Delimiter,Psharp}{;}\prebr{}
{\preindent{2}}\mdToken{Keyword,Psharp}{event}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{TimerCancelled}\mdToken{Delimiter,Psharp}{;}\prebr{}
\prebr{}
{\preindent{2}}\mdToken{Keyword,Psharp}{machine}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{FailureDetector}{\prespace{1}}\mdToken{Delimiter,Curly,Psharp,BracketOpen}{\{}\prebr{}
{\preindent{4}}\mdToken{Type,Identifier,Psharp}{List}\mdToken{Operator,Psharp}{{\textless}}\mdToken{Keyword,Psharp}{machine}\mdToken{Operator,Psharp}{{\textgreater}}{\prespace{1}}\mdToken{Identifier,Psharp}{nodes}\mdToken{Delimiter,Psharp}{;}{\prespace{17}}\mdToken{Comment,Psharp}{//\prespace{1}nodes\prespace{1}to\prespace{1}be\prespace{1}monitored}\prebr{}
{\preindent{4}}\mdToken{Type,Identifier,Psharp}{Dictionary}\mdToken{Operator,Psharp}{{\textless}}\mdToken{Keyword,Psharp}{machine}\mdToken{Delimiter,Psharp}{,}{\prespace{1}}\mdToken{Keyword,Psharp}{bool}\mdToken{Operator,Psharp}{{\textgreater}}{\prespace{1}}\mdToken{Identifier,Psharp}{clients}\mdToken{Delimiter,Psharp}{;}{\prespace{3}}\mdToken{Comment,Psharp}{//\prespace{1}registered\prespace{1}clients}\prebr{}
{\preindent{4}}\mdToken{Keyword,Psharp}{int}{\prespace{1}}\mdToken{Identifier,Psharp}{attempts}\mdToken{Delimiter,Psharp}{;}{\prespace{24}}\mdToken{Comment,Psharp}{//\prespace{1}number\prespace{1}of\prespace{1}Ping\prespace{1}attempts\prespace{1}made}\prebr{}
{\preindent{4}}\mdToken{Type,Identifier,Psharp}{Dictionary}\mdToken{Operator,Psharp}{{\textless}}\mdToken{Keyword,Psharp}{machine}\mdToken{Delimiter,Psharp}{,}{\prespace{1}}\mdToken{Keyword,Psharp}{bool}\mdToken{Operator,Psharp}{{\textgreater}}{\prespace{1}}\mdToken{Identifier,Psharp}{alive}\mdToken{Delimiter,Psharp}{;}{\prespace{5}}\mdToken{Comment,Psharp}{//\prespace{1}set\prespace{1}of\prespace{1}alive\prespace{1}nodes}\prebr{}
{\preindent{4}}\mdToken{Type,Identifier,Psharp}{Dictionary}\mdToken{Operator,Psharp}{{\textless}}\mdToken{Keyword,Psharp}{machine}\mdToken{Delimiter,Psharp}{,}{\prespace{1}}\mdToken{Keyword,Psharp}{bool}\mdToken{Operator,Psharp}{{\textgreater}}{\prespace{1}}\mdToken{Identifier,Psharp}{responses}\mdToken{Delimiter,Psharp}{;}{\prespace{1}}\mdToken{Comment,Psharp}{//\prespace{1}collected\prespace{1}responses\prespace{1}in\prespace{1}one\prespace{1}round}\prebr{}
{\preindent{4}}\mdToken{Keyword,Psharp}{machine}{\prespace{1}}\mdToken{Identifier,Psharp}{timer}\mdToken{Delimiter,Psharp}{;}\prebr{}
\prebr{}
{\preindent{4}}\mdToken{Keyword,Psharp}{start}{\prespace{1}}\mdToken{Keyword,Psharp}{state}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{Init}{\prespace{1}}\mdToken{Delimiter,Curly,Psharp,BracketOpen}{\{}\prebr{}
{\preindent{6}}\mdToken{Keyword,Psharp}{entry}{\prespace{1}}\mdToken{Delimiter,Curly,Psharp,BracketOpen}{\{}\prebr{}
{\preindent{8}}\mdToken{Keyword,Psharp}{this}\mdToken{Delimiter,Psharp}{.}\mdToken{Identifier,Psharp}{nodes}{\prespace{1}}\mdToken{Operator,Psharp}{=}{\prespace{1}}\mdToken{Keyword,Psharp}{new}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{List}\mdToken{Operator,Psharp}{{\textless}}\mdToken{Keyword,Psharp}{machine}\mdToken{Operator,Psharp}{{\textgreater}}\mdToken{Delimiter,Parenthesis,Psharp,BracketOpen}{(}\mdToken{Delimiter,Parenthesis,Psharp,BracketClose}{)}\mdToken{Delimiter,Psharp}{;}\prebr{}
{\preindent{8}}\mdToken{Keyword,Psharp}{this}\mdToken{Delimiter,Psharp}{.}\mdToken{Identifier,Psharp}{clients}{\prespace{1}}\mdToken{Operator,Psharp}{=}{\prespace{1}}\mdToken{Keyword,Psharp}{new}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{Dictionary}\mdToken{Operator,Psharp}{{\textless}}\mdToken{Keyword,Psharp}{machine}\mdToken{Delimiter,Psharp}{,}{\prespace{1}}\mdToken{Keyword,Psharp}{bool}\mdToken{Operator,Psharp}{{\textgreater}}\mdToken{Delimiter,Parenthesis,Psharp,BracketOpen}{(}\mdToken{Delimiter,Parenthesis,Psharp,BracketClose}{)}\mdToken{Delimiter,Psharp}{;}\prebr{}
{\preindent{8}}\mdToken{Keyword,Psharp}{this}\mdToken{Delimiter,Psharp}{.}\mdToken{Identifier,Psharp}{alive}{\prespace{1}}\mdToken{Operator,Psharp}{=}{\prespace{1}}\mdToken{Keyword,Psharp}{new}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{Dictionary}\mdToken{Operator,Psharp}{{\textless}}\mdToken{Keyword,Psharp}{machine}\mdToken{Delimiter,Psharp}{,}{\prespace{1}}\mdToken{Keyword,Psharp}{bool}\mdToken{Operator,Psharp}{{\textgreater}}\mdToken{Delimiter,Parenthesis,Psharp,BracketOpen}{(}\mdToken{Delimiter,Parenthesis,Psharp,BracketClose}{)}\mdToken{Delimiter,Psharp}{;}\prebr{}
{\preindent{8}}\mdToken{Keyword,Psharp}{this}\mdToken{Delimiter,Psharp}{.}\mdToken{Identifier,Psharp}{responses}{\prespace{1}}\mdToken{Operator,Psharp}{=}{\prespace{1}}\mdToken{Keyword,Psharp}{new}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{Dictionary}\mdToken{Operator,Psharp}{{\textless}}\mdToken{Keyword,Psharp}{machine}\mdToken{Delimiter,Psharp}{,}{\prespace{1}}\mdToken{Keyword,Psharp}{bool}\mdToken{Operator,Psharp}{{\textgreater}}\mdToken{Delimiter,Parenthesis,Psharp,BracketOpen}{(}\mdToken{Delimiter,Parenthesis,Psharp,BracketClose}{)}\mdToken{Delimiter,Psharp}{;}\prebr{}
{\preindent{8}}\mdToken{Keyword,Psharp}{this}\mdToken{Delimiter,Psharp}{.}\mdToken{Identifier,Psharp}{nodes}{\prespace{1}}\mdToken{Operator,Psharp}{=}{\prespace{1}}\mdToken{Keyword,Psharp}{payload}{\prespace{1}}\mdToken{Keyword,Psharp}{as}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{List}\mdToken{Operator,Psharp}{{\textless}}\mdToken{Keyword,Psharp}{machine}\mdToken{Operator,Psharp}{{\textgreater}}\mdToken{Delimiter,Psharp}{;}\prebr{}
{\preindent{8}}\mdToken{Keyword,Psharp}{this}\mdToken{Delimiter,Psharp}{.}\mdToken{Type,Identifier,Psharp}{InitializealiveSet}\mdToken{Delimiter,Parenthesis,Psharp,BracketOpen}{(}\mdToken{Delimiter,Parenthesis,Psharp,BracketClose}{)}\mdToken{Delimiter,Psharp}{;}\prebr{}
{\preindent{8}}\mdToken{Keyword,Psharp}{this}\mdToken{Delimiter,Psharp}{.}\mdToken{Identifier,Psharp}{timer}{\prespace{1}}\mdToken{Operator,Psharp}{=}{\prespace{1}}\mdToken{Keyword,Psharp}{create}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{Timer}{\prespace{1}}\mdToken{Delimiter,Parenthesis,Psharp,BracketOpen}{(}{\prespace{1}}\mdToken{Keyword,Psharp}{this}{\prespace{1}}\mdToken{Delimiter,Parenthesis,Psharp,BracketClose}{)}\mdToken{Delimiter,Psharp}{;}\prebr{}
{\preindent{8}}\mdToken{Keyword,Psharp}{raise}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{Unit}\mdToken{Delimiter,Psharp}{;}\prebr{}
{\preindent{6}}\mdToken{Delimiter,Curly,Psharp,BracketClose}{\}}\prebr{}
{\preindent{6}}\prebr{}
{\preindent{6}}\mdToken{Keyword,Psharp}{on}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{RegisterClient}{\prespace{1}}\mdToken{Keyword,Psharp}{do}{\prespace{1}}\mdToken{Delimiter,Curly,Psharp,BracketOpen}{\{}\prebr{}
{\preindent{8}}\mdToken{Keyword,Psharp}{this}\mdToken{Delimiter,Psharp}{.}\mdToken{Identifier,Psharp}{clients}\mdToken{Delimiter,Square,Psharp,BracketOpen}{[}\mdToken{Delimiter,Parenthesis,Psharp,BracketOpen}{(}\mdToken{Keyword,Psharp}{machine}\mdToken{Delimiter,Parenthesis,Psharp,BracketClose}{)}\mdToken{Keyword,Psharp}{payload}\mdToken{Delimiter,Square,Psharp,BracketClose}{]}{\prespace{1}}\mdToken{Operator,Psharp}{=}{\prespace{1}}\mdToken{Keyword,Psharp}{true}\mdToken{Delimiter,Psharp}{;}\prebr{}
{\preindent{6}}\mdToken{Delimiter,Curly,Psharp,BracketClose}{\}}\mdToken{Delimiter,Psharp}{;}\prebr{}
{\preindent{6}}\prebr{}
{\preindent{6}}\mdToken{Keyword,Psharp}{on}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{UnregisterClient}{\prespace{1}}\mdToken{Keyword,Psharp}{do}{\prespace{1}}\mdToken{Delimiter,Curly,Psharp,BracketOpen}{\{}\prebr{}
{\preindent{8}}\mdToken{Keyword,Psharp}{if}{\prespace{1}}\mdToken{Delimiter,Parenthesis,Psharp,BracketOpen}{(}\mdToken{Keyword,Psharp}{this}\mdToken{Delimiter,Psharp}{.}\mdToken{Identifier,Psharp}{clients}\mdToken{Delimiter,Psharp}{.}\mdToken{Type,Identifier,Psharp}{ContainsKey}\mdToken{Delimiter,Parenthesis,Psharp,BracketOpen}{(}\mdToken{Delimiter,Parenthesis,Psharp,BracketOpen}{(}\mdToken{Keyword,Psharp}{machine}\mdToken{Delimiter,Parenthesis,Psharp,BracketClose}{)}\mdToken{Keyword,Psharp}{payload}\mdToken{Delimiter,Parenthesis,Psharp,BracketClose}{)}\mdToken{Delimiter,Parenthesis,Psharp,BracketClose}{)}{\prespace{1}}\mdToken{Delimiter,Curly,Psharp,BracketOpen}{\{}\prebr{}
{\preindent{10}}\mdToken{Keyword,Psharp}{this}\mdToken{Delimiter,Psharp}{.}\mdToken{Identifier,Psharp}{clients}\mdToken{Delimiter,Psharp}{.}\mdToken{Type,Identifier,Psharp}{Remove}\mdToken{Delimiter,Parenthesis,Psharp,BracketOpen}{(}\mdToken{Delimiter,Parenthesis,Psharp,BracketOpen}{(}\mdToken{Keyword,Psharp}{machine}\mdToken{Delimiter,Parenthesis,Psharp,BracketClose}{)}\mdToken{Keyword,Psharp}{payload}\mdToken{Delimiter,Parenthesis,Psharp,BracketClose}{)}\mdToken{Delimiter,Psharp}{;}\prebr{}
{\preindent{8}}\mdToken{Delimiter,Curly,Psharp,BracketClose}{\}}\prebr{}
{\preindent{6}}\mdToken{Delimiter,Curly,Psharp,BracketClose}{\}}\mdToken{Delimiter,Psharp}{;}\prebr{}
{\preindent{6}}\prebr{}
{\preindent{6}}\mdToken{Keyword,Psharp}{on}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{Unit}{\prespace{1}}\mdToken{Keyword,Psharp}{push}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{SendPing}\mdToken{Delimiter,Psharp}{;}\prebr{}
{\preindent{4}}\mdToken{Delimiter,Curly,Psharp,BracketClose}{\}}\prebr{}
{\preindent{4}}\prebr{}
{\preindent{4}}\mdToken{Keyword,Psharp}{state}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{SendPing}\prebr{}
{\preindent{4}}\mdToken{Delimiter,Curly,Psharp,BracketOpen}{\{}\prebr{}
{\preindent{6}}\mdToken{Keyword,Psharp}{entry}{\prespace{1}}\mdToken{Delimiter,Curly,Psharp,BracketOpen}{\{}\prebr{}
{\preindent{8}}\mdToken{Keyword,Psharp}{this}\mdToken{Delimiter,Psharp}{.}\mdToken{Type,Identifier,Psharp}{SendPings}\mdToken{Delimiter,Parenthesis,Psharp,BracketOpen}{(}\mdToken{Delimiter,Parenthesis,Psharp,BracketClose}{)}\mdToken{Delimiter,Psharp}{;}{\prespace{1}}\mdToken{Comment,Psharp}{//\prespace{1}send\prespace{1}Ping\prespace{1}events\prespace{1}to\prespace{1}machines\prespace{1}that\prespace{1}have\prespace{1}not\prespace{1}responded}\prebr{}
{\preindent{8}}\mdToken{Keyword,Psharp}{send}{\prespace{1}}\mdToken{Keyword,Psharp}{this}\mdToken{Delimiter,Psharp}{.}\mdToken{Identifier,Psharp}{timer}\mdToken{Delimiter,Psharp}{,}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{Start}{\prespace{1}}\mdToken{Delimiter,Parenthesis,Psharp,BracketOpen}{(}{\prespace{1}}\mdToken{Number,Psharp}{100}{\prespace{1}}\mdToken{Delimiter,Parenthesis,Psharp,BracketClose}{)}\mdToken{Delimiter,Psharp}{;}{\prespace{1}}\mdToken{Comment,Psharp}{//\prespace{1}start\prespace{1}timer\prespace{1}for\prespace{1}intra-round\prespace{1}duration}\prebr{}
{\preindent{6}}\mdToken{Delimiter,Curly,Psharp,BracketClose}{\}}\prebr{}
{\preindent{6}}\prebr{}
{\preindent{6}}\mdToken{Keyword,Psharp}{on}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{Pong}{\prespace{1}}\mdToken{Keyword,Psharp}{do}{\prespace{1}}\mdToken{Delimiter,Curly,Psharp,BracketOpen}{\{}\prebr{}
{\preindent{8}}\mdToken{Comment,Psharp}{//\prespace{1}collect\prespace{1}Pong\prespace{1}responses\prespace{1}from\prespace{1}alive\prespace{1}machines}\prebr{}
{\preindent{8}}\mdToken{Keyword,Psharp}{if}{\prespace{1}}\mdToken{Delimiter,Parenthesis,Psharp,BracketOpen}{(}\mdToken{Keyword,Psharp}{this}\mdToken{Delimiter,Psharp}{.}\mdToken{Identifier,Psharp}{alive}\mdToken{Delimiter,Psharp}{.}\mdToken{Type,Identifier,Psharp}{ContainsKey}\mdToken{Delimiter,Parenthesis,Psharp,BracketOpen}{(}\mdToken{Delimiter,Parenthesis,Psharp,BracketOpen}{(}\mdToken{Keyword,Psharp}{machine}\mdToken{Delimiter,Parenthesis,Psharp,BracketClose}{)}\mdToken{Keyword,Psharp}{payload}\mdToken{Delimiter,Parenthesis,Psharp,BracketClose}{)}\mdToken{Delimiter,Parenthesis,Psharp,BracketClose}{)}\prebr{}
{\preindent{8}}\mdToken{Delimiter,Curly,Psharp,BracketOpen}{\{}\prebr{}
{\preindent{10}}\mdToken{Keyword,Psharp}{this}\mdToken{Delimiter,Psharp}{.}\mdToken{Identifier,Psharp}{responses}\mdToken{Delimiter,Square,Psharp,BracketOpen}{[}\mdToken{Delimiter,Parenthesis,Psharp,BracketOpen}{(}\mdToken{Keyword,Psharp}{machine}\mdToken{Delimiter,Parenthesis,Psharp,BracketClose}{)}\mdToken{Keyword,Psharp}{payload}\mdToken{Delimiter,Square,Psharp,BracketClose}{]}{\prespace{1}}\mdToken{Operator,Psharp}{=}{\prespace{1}}\mdToken{Keyword,Psharp}{true}\mdToken{Delimiter,Psharp}{;}\prebr{}
{\preindent{10}}\mdToken{Keyword,Psharp}{if}{\prespace{1}}\mdToken{Delimiter,Parenthesis,Psharp,BracketOpen}{(}\mdToken{Keyword,Psharp}{this}\mdToken{Delimiter,Psharp}{.}\mdToken{Identifier,Psharp}{responses}\mdToken{Delimiter,Psharp}{.}\mdToken{Type,Identifier,Psharp}{Count}{\prespace{1}}\mdToken{Operator,Psharp}{==}{\prespace{1}}\mdToken{Keyword,Psharp}{this}\mdToken{Delimiter,Psharp}{.}\mdToken{Identifier,Psharp}{alive}\mdToken{Delimiter,Psharp}{.}\mdToken{Type,Identifier,Psharp}{Count}\mdToken{Delimiter,Parenthesis,Psharp,BracketClose}{)}{\prespace{1}}\mdToken{Delimiter,Curly,Psharp,BracketOpen}{\{}\prebr{}
{\preindent{12}}\mdToken{Comment,Psharp}{//\prespace{1}status\prespace{1}of\prespace{1}alive\prespace{1}nodes\prespace{1}has\prespace{1}not\prespace{1}changed}\prebr{}
{\preindent{12}}\mdToken{Keyword,Psharp}{send}{\prespace{1}}\mdToken{Keyword,Psharp}{this}\mdToken{Delimiter,Psharp}{.}\mdToken{Identifier,Psharp}{timer}\mdToken{Delimiter,Psharp}{,}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{Cancel}\mdToken{Delimiter,Psharp}{;}\prebr{}
{\preindent{12}}\mdToken{Keyword,Psharp}{raise}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{TimerCancelled}\mdToken{Delimiter,Psharp}{;}\prebr{}
{\preindent{10}}\mdToken{Delimiter,Curly,Psharp,BracketClose}{\}}\prebr{}
{\preindent{8}}\mdToken{Delimiter,Curly,Psharp,BracketClose}{\}}\prebr{}
{\preindent{6}}\mdToken{Delimiter,Curly,Psharp,BracketClose}{\}}\mdToken{Delimiter,Psharp}{;}\prebr{}
{\preindent{6}}\prebr{}
{\preindent{6}}\mdToken{Keyword,Psharp}{on}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{TimerCancelled}{\prespace{1}}\mdToken{Keyword,Psharp}{push}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{WaitForCancelResponse}\mdToken{Delimiter,Psharp}{;}\prebr{}
{\preindent{6}}\prebr{}
{\preindent{6}}\mdToken{Keyword,Psharp}{on}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{Timeout}{\prespace{1}}\mdToken{Keyword,Psharp}{do}{\prespace{1}}\mdToken{Delimiter,Curly,Psharp,BracketOpen}{\{}\prebr{}
{\preindent{8}}\mdToken{Comment,Psharp}{//\prespace{1}one\prespace{1}attempt\prespace{1}is\prespace{1}done}\prebr{}
{\preindent{8}}\mdToken{Keyword,Psharp}{this}\mdToken{Delimiter,Psharp}{.}\mdToken{Identifier,Psharp}{attempts}++\mdToken{Delimiter,Psharp}{;}\prebr{}
{\preindent{8}}\mdToken{Comment,Psharp}{//\prespace{1}maximum\prespace{1}number\prespace{1}of\prespace{1}attempts\prespace{1}per\prespace{1}round\prespace{1}==\prespace{1}2}\prebr{}
{\preindent{8}}\mdToken{Keyword,Psharp}{if}{\prespace{1}}\mdToken{Delimiter,Parenthesis,Psharp,BracketOpen}{(}\mdToken{Keyword,Psharp}{this}\mdToken{Delimiter,Psharp}{.}\mdToken{Identifier,Psharp}{responses}\mdToken{Delimiter,Psharp}{.}\mdToken{Type,Identifier,Psharp}{Count}{\prespace{1}}\mdToken{Operator,Psharp}{{\textless}}{\prespace{1}}\mdToken{Keyword,Psharp}{this}\mdToken{Delimiter,Psharp}{.}\mdToken{Identifier,Psharp}{alive}\mdToken{Delimiter,Psharp}{.}\mdToken{Type,Identifier,Psharp}{Count}{\prespace{1}}\mdToken{Operator,Psharp}{{\&}{\&}}{\prespace{1}}\mdToken{Keyword,Psharp}{this}\mdToken{Delimiter,Psharp}{.}\mdToken{Identifier,Psharp}{attempts}{\prespace{1}}\mdToken{Operator,Psharp}{{\textless}}{\prespace{1}}\mdToken{Number,Psharp}{2}\mdToken{Delimiter,Parenthesis,Psharp,BracketClose}{)}{\prespace{1}}\mdToken{Delimiter,Curly,Psharp,BracketOpen}{\{}\prebr{}
{\preindent{10}}\mdToken{Keyword,Psharp}{raise}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{Unit}\mdToken{Delimiter,Psharp}{;}{\prespace{1}}\mdToken{Comment,Psharp}{//\prespace{1}try\prespace{1}again\prespace{1}by\prespace{1}re-entering\prespace{1}SendPing}\prebr{}
{\preindent{8}}\mdToken{Delimiter,Curly,Psharp,BracketClose}{\}}{\prespace{1}}\mdToken{Keyword,Psharp}{else}{\prespace{1}}\mdToken{Delimiter,Curly,Psharp,BracketOpen}{\{}\prebr{}
{\preindent{10}}\mdToken{Keyword,Psharp}{this}\mdToken{Delimiter,Psharp}{.}\mdToken{Type,Identifier,Psharp}{CheckaliveSet}\mdToken{Delimiter,Parenthesis,Psharp,BracketOpen}{(}\mdToken{Delimiter,Parenthesis,Psharp,BracketClose}{)}\mdToken{Delimiter,Psharp}{;}\prebr{}
{\preindent{10}}\mdToken{Keyword,Psharp}{raise}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{RoundDone}\mdToken{Delimiter,Psharp}{;}\prebr{}
{\preindent{8}}\mdToken{Delimiter,Curly,Psharp,BracketClose}{\}}\prebr{}
{\preindent{6}}\mdToken{Delimiter,Curly,Psharp,BracketClose}{\}}\mdToken{Delimiter,Psharp}{;}\prebr{}
{\preindent{6}}\prebr{}
{\preindent{6}}\mdToken{Keyword,Psharp}{on}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{Unit}{\prespace{1}}\mdToken{Keyword,Psharp}{goto}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{SendPing}\mdToken{Delimiter,Psharp}{;}\prebr{}
{\preindent{6}}\mdToken{Keyword,Psharp}{on}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{RoundDone}{\prespace{1}}\mdToken{Keyword,Psharp}{goto}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{Reset}\mdToken{Delimiter,Psharp}{;}\prebr{}
{\preindent{4}}\mdToken{Delimiter,Curly,Psharp,BracketClose}{\}}\prebr{}
{\preindent{4}}\prebr{}
{\preindent{4}}\mdToken{Keyword,Psharp}{state}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{WaitForCancelResponse}{\prespace{1}}\mdToken{Delimiter,Curly,Psharp,BracketOpen}{\{}\prebr{}
{\preindent{6}}\mdToken{Keyword,Psharp}{defer}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{Timeout}\mdToken{Delimiter,Psharp}{,}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{Pong}\mdToken{Delimiter,Psharp}{;}\prebr{}
{\preindent{6}}\prebr{}
{\preindent{6}}\mdToken{Keyword,Psharp}{on}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{CancelSuccess}{\prespace{1}}\mdToken{Keyword,Psharp}{do}{\prespace{1}}\mdToken{Delimiter,Curly,Psharp,BracketOpen}{\{}\prebr{}
{\preindent{8}}\mdToken{Keyword,Psharp}{raise}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{RoundDone}\mdToken{Delimiter,Psharp}{;}\prebr{}
{\preindent{6}}\mdToken{Delimiter,Curly,Psharp,BracketClose}{\}}\mdToken{Delimiter,Psharp}{;}\prebr{}
{\preindent{6}}\prebr{}
{\preindent{6}}\mdToken{Keyword,Psharp}{on}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{CancelFailure}{\prespace{1}}\mdToken{Keyword,Psharp}{do}{\prespace{1}}\mdToken{Delimiter,Curly,Psharp,BracketOpen}{\{}\prebr{}
{\preindent{8}}\mdToken{Keyword,Psharp}{pop}\mdToken{Delimiter,Psharp}{;}\prebr{}
{\preindent{6}}\mdToken{Delimiter,Curly,Psharp,BracketClose}{\}}\mdToken{Delimiter,Psharp}{;}\prebr{}
{\preindent{4}}\mdToken{Delimiter,Curly,Psharp,BracketClose}{\}}\prebr{}
{\preindent{4}}\prebr{}
{\preindent{4}}\mdToken{Keyword,Psharp}{state}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{Reset}{\prespace{1}}\mdToken{Delimiter,Curly,Psharp,BracketOpen}{\{}\prebr{}
{\preindent{6}}\mdToken{Keyword,Psharp}{entry}{\prespace{1}}\mdToken{Delimiter,Curly,Psharp,BracketOpen}{\{}\prebr{}
{\preindent{8}}\mdToken{Comment,Psharp}{//\prespace{1}prepare\prespace{1}for\prespace{1}the\prespace{1}next\prespace{1}round}\prebr{}
{\preindent{8}}\mdToken{Keyword,Psharp}{this}\mdToken{Delimiter,Psharp}{.}\mdToken{Identifier,Psharp}{attempts}{\prespace{1}}\mdToken{Operator,Psharp}{=}{\prespace{1}}\mdToken{Number,Psharp}{0}\mdToken{Delimiter,Psharp}{;}\prebr{}
{\preindent{8}}\mdToken{Keyword,Psharp}{this}\mdToken{Delimiter,Psharp}{.}\mdToken{Identifier,Psharp}{responses}\mdToken{Delimiter,Psharp}{.}\mdToken{Type,Identifier,Psharp}{Clear}\mdToken{Delimiter,Parenthesis,Psharp,BracketOpen}{(}\mdToken{Delimiter,Parenthesis,Psharp,BracketClose}{)}\mdToken{Delimiter,Psharp}{;}\prebr{}
{\preindent{8}}\mdToken{Keyword,Psharp}{send}{\prespace{1}}\mdToken{Keyword,Psharp}{this}\mdToken{Delimiter,Psharp}{.}\mdToken{Identifier,Psharp}{timer}\mdToken{Delimiter,Psharp}{,}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{Start}{\prespace{1}}\mdToken{Delimiter,Parenthesis,Psharp,BracketOpen}{(}{\prespace{1}}\mdToken{Number,Psharp}{1000}{\prespace{1}}\mdToken{Delimiter,Parenthesis,Psharp,BracketClose}{)}\mdToken{Delimiter,Psharp}{;}{\prespace{1}}\mdToken{Comment,Psharp}{//\prespace{1}start\prespace{1}timer\prespace{1}for\prespace{1}inter-round\prespace{1}duration}\prebr{}
{\preindent{6}}\mdToken{Delimiter,Curly,Psharp,BracketClose}{\}}\prebr{}
{\preindent{6}}\prebr{}
{\preindent{6}}\mdToken{Keyword,Psharp}{on}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{Timeout}{\prespace{1}}\mdToken{Keyword,Psharp}{goto}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{SendPing}\mdToken{Delimiter,Psharp}{;}\prebr{}
{\preindent{6}}\mdToken{Keyword,Psharp}{ignore}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{Pong}\mdToken{Delimiter,Psharp}{;}\prebr{}
{\preindent{4}}\mdToken{Delimiter,Curly,Psharp,BracketClose}{\}}\prebr{}
{\preindent{4}}\prebr{}
{\preindent{4}}\mdToken{Keyword,Psharp}{void}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{InitializealiveSet}\mdToken{Delimiter,Parenthesis,Psharp,BracketOpen}{(}\mdToken{Delimiter,Parenthesis,Psharp,BracketClose}{)}{\prespace{1}}\mdToken{Delimiter,Curly,Psharp,BracketOpen}{\{}\prebr{}
{\preindent{6}}\mdToken{Keyword,Psharp}{foreach}{\prespace{1}}\mdToken{Delimiter,Parenthesis,Psharp,BracketOpen}{(}\mdToken{Keyword,Psharp}{var}{\prespace{1}}\mdToken{Identifier,Psharp}{node}{\prespace{1}}\mdToken{Keyword,Psharp}{in}{\prespace{1}}\mdToken{Keyword,Psharp}{this}\mdToken{Delimiter,Psharp}{.}\mdToken{Identifier,Psharp}{nodes}\mdToken{Delimiter,Parenthesis,Psharp,BracketClose}{)}{\prespace{1}}\mdToken{Delimiter,Curly,Psharp,BracketOpen}{\{}\prebr{}
{\preindent{8}}\mdToken{Keyword,Psharp}{this}\mdToken{Delimiter,Psharp}{.}\mdToken{Identifier,Psharp}{alive}\mdToken{Delimiter,Psharp}{.}\mdToken{Type,Identifier,Psharp}{Add}\mdToken{Delimiter,Parenthesis,Psharp,BracketOpen}{(}\mdToken{Identifier,Psharp}{node}\mdToken{Delimiter,Psharp}{,}{\prespace{1}}\mdToken{Keyword,Psharp}{true}\mdToken{Delimiter,Parenthesis,Psharp,BracketClose}{)}\mdToken{Delimiter,Psharp}{;}\prebr{}
{\preindent{6}}\mdToken{Delimiter,Curly,Psharp,BracketClose}{\}}\prebr{}
{\preindent{4}}\mdToken{Delimiter,Curly,Psharp,BracketClose}{\}}\prebr{}
{\preindent{4}}\prebr{}
{\preindent{4}}\mdToken{Keyword,Psharp}{void}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{SendPings}\mdToken{Delimiter,Parenthesis,Psharp,BracketOpen}{(}\mdToken{Delimiter,Parenthesis,Psharp,BracketClose}{)}{\prespace{1}}\mdToken{Delimiter,Curly,Psharp,BracketOpen}{\{}\prebr{}
{\preindent{6}}\mdToken{Keyword,Psharp}{foreach}{\prespace{1}}\mdToken{Delimiter,Parenthesis,Psharp,BracketOpen}{(}\mdToken{Keyword,Psharp}{var}{\prespace{1}}\mdToken{Identifier,Psharp}{node}{\prespace{1}}\mdToken{Keyword,Psharp}{in}{\prespace{1}}\mdToken{Keyword,Psharp}{this}\mdToken{Delimiter,Psharp}{.}\mdToken{Identifier,Psharp}{nodes}\mdToken{Delimiter,Parenthesis,Psharp,BracketClose}{)}{\prespace{1}}\mdToken{Delimiter,Curly,Psharp,BracketOpen}{\{}\prebr{}
{\preindent{8}}\mdToken{Keyword,Psharp}{if}{\prespace{1}}\mdToken{Delimiter,Parenthesis,Psharp,BracketOpen}{(}\mdToken{Keyword,Psharp}{this}\mdToken{Delimiter,Psharp}{.}\mdToken{Identifier,Psharp}{alive}\mdToken{Delimiter,Psharp}{.}\mdToken{Type,Identifier,Psharp}{ContainsKey}\mdToken{Delimiter,Parenthesis,Psharp,BracketOpen}{(}\mdToken{Identifier,Psharp}{node}\mdToken{Delimiter,Parenthesis,Psharp,BracketClose}{)}{\prespace{1}}\mdToken{Operator,Psharp}{{\&}{\&}}{\prespace{1}}\mdToken{Operator,Psharp}{!}\mdToken{Keyword,Psharp}{this}\mdToken{Delimiter,Psharp}{.}\mdToken{Identifier,Psharp}{responses}\mdToken{Delimiter,Psharp}{.}\mdToken{Type,Identifier,Psharp}{ContainsKey}\mdToken{Delimiter,Parenthesis,Psharp,BracketOpen}{(}\mdToken{Identifier,Psharp}{node}\mdToken{Delimiter,Parenthesis,Psharp,BracketClose}{)}\mdToken{Delimiter,Parenthesis,Psharp,BracketClose}{)}{\prespace{1}}\mdToken{Delimiter,Curly,Psharp,BracketOpen}{\{}\prebr{}
{\preindent{10}}\mdToken{Keyword,Psharp}{monitor}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{Safety}\mdToken{Delimiter,Psharp}{,}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{MPing}{\prespace{1}}\mdToken{Delimiter,Parenthesis,Psharp,BracketOpen}{(}{\prespace{1}}\mdToken{Identifier,Psharp}{node}{\prespace{1}}\mdToken{Delimiter,Parenthesis,Psharp,BracketClose}{)}\mdToken{Delimiter,Psharp}{;}\prebr{}
{\preindent{10}}\mdToken{Keyword,Psharp}{send}{\prespace{1}}\mdToken{Identifier,Psharp}{node}\mdToken{Delimiter,Psharp}{,}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{Ping}{\prespace{1}}\mdToken{Delimiter,Parenthesis,Psharp,BracketOpen}{(}{\prespace{1}}\mdToken{Keyword,Psharp}{this}{\prespace{1}}\mdToken{Delimiter,Parenthesis,Psharp,BracketClose}{)}\mdToken{Delimiter,Psharp}{;}\prebr{}
{\preindent{8}}\mdToken{Delimiter,Curly,Psharp,BracketClose}{\}}\prebr{}
{\preindent{6}}\mdToken{Delimiter,Curly,Psharp,BracketClose}{\}}\prebr{}
{\preindent{4}}\mdToken{Delimiter,Curly,Psharp,BracketClose}{\}}\prebr{}
{\preindent{4}}\prebr{}
{\preindent{4}}\mdToken{Keyword,Psharp}{void}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{CheckaliveSet}\mdToken{Delimiter,Parenthesis,Psharp,BracketOpen}{(}\mdToken{Delimiter,Parenthesis,Psharp,BracketClose}{)}{\prespace{1}}\mdToken{Delimiter,Curly,Psharp,BracketOpen}{\{}\prebr{}
{\preindent{6}}\mdToken{Keyword,Psharp}{foreach}{\prespace{1}}\mdToken{Delimiter,Parenthesis,Psharp,BracketOpen}{(}\mdToken{Keyword,Psharp}{var}{\prespace{1}}\mdToken{Identifier,Psharp}{node}{\prespace{1}}\mdToken{Keyword,Psharp}{in}{\prespace{1}}\mdToken{Keyword,Psharp}{this}\mdToken{Delimiter,Psharp}{.}\mdToken{Identifier,Psharp}{nodes}\mdToken{Delimiter,Parenthesis,Psharp,BracketClose}{)}{\prespace{1}}\mdToken{Delimiter,Curly,Psharp,BracketOpen}{\{}\prebr{}
{\preindent{8}}\mdToken{Keyword,Psharp}{if}{\prespace{1}}\mdToken{Delimiter,Parenthesis,Psharp,BracketOpen}{(}\mdToken{Keyword,Psharp}{this}\mdToken{Delimiter,Psharp}{.}\mdToken{Identifier,Psharp}{alive}\mdToken{Delimiter,Psharp}{.}\mdToken{Type,Identifier,Psharp}{ContainsKey}\mdToken{Delimiter,Parenthesis,Psharp,BracketOpen}{(}\mdToken{Identifier,Psharp}{node}\mdToken{Delimiter,Parenthesis,Psharp,BracketClose}{)}{\prespace{1}}\mdToken{Operator,Psharp}{{\&}{\&}}{\prespace{1}}\mdToken{Operator,Psharp}{!}\mdToken{Keyword,Psharp}{this}\mdToken{Delimiter,Psharp}{.}\mdToken{Identifier,Psharp}{responses}\mdToken{Delimiter,Psharp}{.}\mdToken{Type,Identifier,Psharp}{ContainsKey}\mdToken{Delimiter,Parenthesis,Psharp,BracketOpen}{(}\mdToken{Identifier,Psharp}{node}\mdToken{Delimiter,Parenthesis,Psharp,BracketClose}{)}\mdToken{Delimiter,Parenthesis,Psharp,BracketClose}{)}{\prespace{1}}\mdToken{Delimiter,Curly,Psharp,BracketOpen}{\{}\prebr{}
{\preindent{10}}\mdToken{Keyword,Psharp}{this}\mdToken{Delimiter,Psharp}{.}\mdToken{Identifier,Psharp}{alive}\mdToken{Delimiter,Psharp}{.}\mdToken{Type,Identifier,Psharp}{Remove}\mdToken{Delimiter,Parenthesis,Psharp,BracketOpen}{(}\mdToken{Identifier,Psharp}{node}\mdToken{Delimiter,Parenthesis,Psharp,BracketClose}{)}\mdToken{Delimiter,Psharp}{;}\prebr{}
{\preindent{8}}\mdToken{Delimiter,Curly,Psharp,BracketClose}{\}}\prebr{}
{\preindent{6}}\mdToken{Delimiter,Curly,Psharp,BracketClose}{\}}\prebr{}
{\preindent{4}}\mdToken{Delimiter,Curly,Psharp,BracketClose}{\}}\prebr{}
{\preindent{2}}\mdToken{Delimiter,Curly,Psharp,BracketClose}{\}}\prebr{}
\mdToken{Delimiter,Curly,Psharp,BracketClose}{\}}}%mdk
\end{mdPre}%mdk
\begin{mdP}[data-line={512}]%mdk
%mdk-data-line={512}
{}The state %mdk-data-line={512}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{Init}}%mdk-data-line={512}
{} of the %mdk-data-line={512}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{FailureDetector}}%mdk-data-line={512}
{} machine illustrates the use of %mdk-data-line={512}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Keyword,Psharp}{push}}%mdk-data-line={512}
{}
transitions.
After appropriately initializing fields in the entry action, the raised event
%mdk-data-line={515}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{Unit}}%mdk-data-line={515}
{} is handled by %mdk-data-line={515}
{}\mdEm{pushing}%mdk-data-line={515}
{} state %mdk-data-line={515}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{SendPing}}%mdk-data-line={515}
{} on top of the current state
%mdk-data-line={516}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{Init}}%mdk-data-line={516}
{}. Thus, the use of %mdk-data-line={516}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Keyword,Psharp}{push}}%mdk-data-line={516}
{} transitions creates a stack of states encoding
the control of a state-machine.
As long as state %mdk-data-line={518}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{Init}}%mdk-data-line={518}
{} is on the stack, event handlers declared inside it are
available to be executed regardless of changes in any states above it.
The event handlers for %mdk-data-line={520}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{RegisterClient}}%mdk-data-line={520}
{} and %mdk-data-line={520}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{UnregisterClient}}%mdk-data-line={520}
{} are such available
handlers.
A %mdk-data-line={522}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Keyword,Psharp}{push}}%mdk-data-line={522}
{} transition from %mdk-data-line={522}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{Init}}%mdk-data-line={522}
{} to %mdk-data-line={522}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{SendPing}}%mdk-data-line={522}
{} (rather than a %mdk-data-line={522}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Keyword,Psharp}{goto}}%mdk-data-line={522}
{} transition)
enables the declaration of these handlers in one place (the %mdk-data-line={523}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{Init}}%mdk-data-line={523}
{} state) and
their reuse everywhere else in %mdk-data-line={524}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{FailureDetector}}%mdk-data-line={524}
{}.
In addition to offering reuse of event handlers, push transitions also enable
reuse of protocol logic for handling specific interactions with other machines.
We later explain this use of a %mdk-data-line={527}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Keyword,Psharp}{push}}%mdk-data-line={527}
{} transition in handling the interaction
between %mdk-data-line={528}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{FailureDetector}}%mdk-data-line={528}
{} and %mdk-data-line={528}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{Timer}}%mdk-data-line={528}
{}.%mdk
\end{mdP}%mdk
\begin{mdP}[class={indent},data-line={530}]%mdk
%mdk-data-line={530}
{}When the state %mdk-data-line={530}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{SendPing}}%mdk-data-line={530}
{} of the %mdk-data-line={530}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{FailureDetector}}%mdk-data-line={530}
{} machine is entered, its entry
action sends %mdk-data-line={531}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{Ping}}%mdk-data-line={531}
{} events to all alive nodes that have not yet responded with
a %mdk-data-line={532}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{Pong}}%mdk-data-line={532}
{} event and starts a timer with a timeout value of 100ms.
The machine stays in this state collecting %mdk-data-line={533}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{Pong}}%mdk-data-line={533}
{} responses until either all alive
nodes have responded or a %mdk-data-line={534}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{Timeout}}%mdk-data-line={534}
{} event is dequeued.
If each alive node has responded with a %mdk-data-line={535}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{Pong}}%mdk-data-line={535}
{} before %mdk-data-line={535}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{Timeout}}%mdk-data-line={535}
{} is dequeued, the
timer is canceled and the event %mdk-data-line={536}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{TimerCancelled}}%mdk-data-line={536}
{} is raised. Otherwise, the handler
of %mdk-data-line={537}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{Timeout}}%mdk-data-line={537}
{} is executed to determine whether another attempt to reach the
potentially alive nodes should be made. If the number of attempts has reached the
maximum number of attempts (2 in this example), then the nodes have failed.%mdk
\end{mdP}%mdk
\begin{mdP}[class={indent},data-line={541}]%mdk
%mdk-data-line={541}
{}The state %mdk-data-line={541}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{SendPing}}%mdk-data-line={541}
{} of %mdk-data-line={541}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{FailureDetector}}%mdk-data-line={541}
{} illustrates the use of a %mdk-data-line={541}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Keyword,Psharp}{push}}%mdk-data-line={541}
{} transition
to factor out the logic for handling timer cancelation.
When %mdk-data-line={543}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{TimerCancelled}}%mdk-data-line={543}
{} is raised after canceling the timer because all alive nodes
have responded with %mdk-data-line={544}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{Pong}}%mdk-data-line={544}
{}, the handler %mdk-data-line={544}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Keyword,Psharp}{on}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{TimerCancelled}{\prespace{1}}\mdToken{Keyword,Psharp}{push}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{WaitForCancelResponse}}%mdk-data-line={544}
{}
pushes the state %mdk-data-line={545}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{WaitForCancelResponse}}%mdk-data-line={545}
{} on top of the state %mdk-data-line={545}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{SendPing}}%mdk-data-line={545}
{}.
The state %mdk-data-line={546}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{WaitForCancelResponse}}%mdk-data-line={546}
{} handles the interaction with the timer subsequent
to its cancelation, returning control back to %mdk-data-line={547}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{SendPing}}%mdk-data-line={547}
{} afterwards. The timer may
respond with either %mdk-data-line={548}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{CancelSuccess}}%mdk-data-line={548}
{} or %mdk-data-line={548}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{CancelFailure}}%mdk-data-line={548}
{}.
In the former case, the event %mdk-data-line={549}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{RoundDone}}%mdk-data-line={549}
{} is raised which is not handled in state
%mdk-data-line={550}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{TimerCancelled}}%mdk-data-line={550}
{} causing the state to be popped and letting the state %mdk-data-line={550}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{SendPing}}%mdk-data-line={550}
{}
handle the %mdk-data-line={551}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{RoundDone}}%mdk-data-line={551}
{} event.
In the latter case, the %mdk-data-line={552}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Keyword,Psharp}{pop}}%mdk-data-line={552}
{} statement executes causing %mdk-data-line={552}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{TimerCancelled}}%mdk-data-line={552}
{} to be
popped and a fresh event being dequeued in the state %mdk-data-line={553}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{SendPing}}%mdk-data-line={553}
{}.%mdk
\end{mdP}%mdk
\begin{mdP}[class={indent},data-line={555}]%mdk
%mdk-data-line={555}
{}The state %mdk-data-line={555}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{WaitForCancelResponse}}%mdk-data-line={555}
{} uses the code %mdk-data-line={555}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Keyword,Psharp}{defer}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{Timeout}\mdToken{Delimiter,Psharp}{,}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{Pong}}%mdk-data-line={555}
{} to indicate
that it is not willing to handle %mdk-data-line={556}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{Timeout}}%mdk-data-line={556}
{} and %mdk-data-line={556}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{Pong}}%mdk-data-line={556}
{} states in this state.
Therefore, while the machine is blocked in this state, the P%mdk-data-line={557}
{}\#%mdk-data-line={557}
{} runtime does not
dequeue these two events, instead %mdk-data-line={558}
{}\mdEm{skips}%mdk-data-line={558}
{} them to retrieve any other event in the
input queue.%mdk
\end{mdP}%mdk
\begin{mdP}[class={indent},data-line={561}]%mdk
%mdk-data-line={561}
{}When the %mdk-data-line={561}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{FailureDetector}}%mdk-data-line={561}
{} machine is blocked in the state %mdk-data-line={561}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{WaitForCancelResponse}}%mdk-data-line={561}
{},
its stack has three states on it.
Starting from the bottom of the stack, these states are %mdk-data-line={563}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{Init}}%mdk-data-line={563}
{}, %mdk-data-line={563}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{SendPing}}%mdk-data-line={563}
{}, and
%mdk-data-line={564}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{WaitForCancelResponse}}%mdk-data-line={564}
{}.
The %mdk-data-line={565}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{Init}}%mdk-data-line={565}
{} state specifies %mdk-data-line={565}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Keyword,Psharp}{do}}%mdk-data-line={565}
{} handlers for %mdk-data-line={565}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{RegisterClient}}%mdk-data-line={565}
{} and %mdk-data-line={565}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{UnregisterClient}}%mdk-data-line={565}
{},
the %mdk-data-line={566}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{SendPing}}%mdk-data-line={566}
{} state specifies %mdk-data-line={566}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Keyword,Psharp}{do}}%mdk-data-line={566}
{} handlers for %mdk-data-line={566}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{Pong}}%mdk-data-line={566}
{} and %mdk-data-line={566}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{Timeout}}%mdk-data-line={566}
{},
and the %mdk-data-line={567}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{WaitForCancelResponse}}%mdk-data-line={567}
{} state defers %mdk-data-line={567}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{Pong}}%mdk-data-line={567}
{} and %mdk-data-line={567}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{Timeout}}%mdk-data-line={567}
{}.
The dequeue logic for P%mdk-data-line={568}
{}\#%mdk-data-line={568}
{} allows the execution of %mdk-data-line={568}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Keyword,Psharp}{do}}%mdk-data-line={568}
{} handlers specified anywhere
in the stack %mdk-data-line={569}
{}\mdEm{unless}%mdk-data-line={569}
{} deferred in a state above.
Therefore, in the state %mdk-data-line={570}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{WaitForCancelResponse}}%mdk-data-line={570}
{}, the events %mdk-data-line={570}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{RegisterClient}}%mdk-data-line={570}
{} and
%mdk-data-line={571}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{UnregisterClient}}%mdk-data-line={571}
{} may be dequeued, but the events %mdk-data-line={571}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{Timeout}}%mdk-data-line={571}
{} and %mdk-data-line={571}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{Pong}}%mdk-data-line={571}
{} may not.%mdk
\end{mdP}%mdk
\begin{mdPre}[class={para-block,pre-fenced,pre-fenced3,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp},data-line={573},data-line-code={574}]%mdk
\mdPrecode[data-line={574}]{\mdToken{Comment,Psharp}{//\prespace{1}Node.psharp}\prebr{}
\mdToken{Keyword,Psharp}{namespace}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{FailureDetector}{\prespace{1}}\mdToken{Delimiter,Curly,Psharp,BracketOpen}{\{}\prebr{}
{\preindent{2}}\mdToken{Keyword,Psharp}{machine}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{Node}\prebr{}
{\preindent{2}}\mdToken{Delimiter,Curly,Psharp,BracketOpen}{\{}\prebr{}
{\preindent{4}}\mdToken{Keyword,Psharp}{start}{\prespace{1}}\mdToken{Keyword,Psharp}{state}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{WaitPing}\prebr{}
{\preindent{4}}\mdToken{Delimiter,Curly,Psharp,BracketOpen}{\{}\prebr{}
{\preindent{6}}\mdToken{Keyword,Psharp}{on}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{Ping}{\prespace{1}}\mdToken{Keyword,Psharp}{do}\prebr{}
{\preindent{6}}\mdToken{Delimiter,Curly,Psharp,BracketOpen}{\{}\prebr{}
{\preindent{8}}\mdToken{Keyword,Psharp}{monitor}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{Safety}\mdToken{Delimiter,Psharp}{,}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{MPong}{\prespace{1}}\mdToken{Delimiter,Parenthesis,Psharp,BracketOpen}{(}{\prespace{1}}\mdToken{Keyword,Psharp}{this}{\prespace{1}}\mdToken{Delimiter,Parenthesis,Psharp,BracketClose}{)}\mdToken{Delimiter,Psharp}{;}\prebr{}
{\preindent{8}}\mdToken{Keyword,Psharp}{send}{\prespace{1}}\mdToken{Delimiter,Parenthesis,Psharp,BracketOpen}{(}\mdToken{Keyword,Psharp}{machine}\mdToken{Delimiter,Parenthesis,Psharp,BracketClose}{)}\mdToken{Keyword,Psharp}{payload}\mdToken{Delimiter,Psharp}{,}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{Pong}{\prespace{1}}\mdToken{Delimiter,Parenthesis,Psharp,BracketOpen}{(}{\prespace{1}}\mdToken{Keyword,Psharp}{this}{\prespace{1}}\mdToken{Delimiter,Parenthesis,Psharp,BracketClose}{)}\mdToken{Delimiter,Psharp}{;}\prebr{}
{\preindent{6}}\mdToken{Delimiter,Curly,Psharp,BracketClose}{\}}\mdToken{Delimiter,Psharp}{;}\prebr{}
{\preindent{4}}\mdToken{Delimiter,Curly,Psharp,BracketClose}{\}}\prebr{}
{\preindent{2}}\mdToken{Delimiter,Curly,Psharp,BracketClose}{\}}\prebr{}
\mdToken{Delimiter,Curly,Psharp,BracketClose}{\}}\prebr{}
\prebr{}
\mdToken{Comment,Psharp}{//\prespace{1}Safety.psharp}\prebr{}
\mdToken{Keyword,Psharp}{namespace}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{FailureDetector}{\prespace{1}}\mdToken{Delimiter,Curly,Psharp,BracketOpen}{\{}\prebr{}
{\preindent{2}}\mdToken{Keyword,Psharp}{event}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{MPing}\mdToken{Delimiter,Psharp}{;}\prebr{}
{\preindent{2}}\mdToken{Keyword,Psharp}{event}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{MPong}\mdToken{Delimiter,Psharp}{;}\prebr{}
{\preindent{2}}\prebr{}
{\preindent{2}}\mdToken{Keyword,Psharp}{monitor}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{Safety}{\prespace{1}}\mdToken{Delimiter,Curly,Psharp,BracketOpen}{\{}\prebr{}
{\preindent{4}}\mdToken{Type,Identifier,Psharp}{Dictionary}\mdToken{Operator,Psharp}{{\textless}}\mdToken{Keyword,Psharp}{machine}\mdToken{Delimiter,Psharp}{,}{\prespace{1}}\mdToken{Keyword,Psharp}{int}\mdToken{Operator,Psharp}{{\textgreater}}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{Pending}\mdToken{Delimiter,Psharp}{;}\prebr{}
{\preindent{4}}\prebr{}
{\preindent{4}}\mdToken{Keyword,Psharp}{start}{\prespace{1}}\mdToken{Keyword,Psharp}{state}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{Init}{\prespace{1}}\mdToken{Delimiter,Curly,Psharp,BracketOpen}{\{}\prebr{}
{\preindent{6}}\mdToken{Keyword,Psharp}{entry}{\prespace{1}}\mdToken{Delimiter,Curly,Psharp,BracketOpen}{\{}\prebr{}
{\preindent{8}}\mdToken{Keyword,Psharp}{this}\mdToken{Delimiter,Psharp}{.}\mdToken{Type,Identifier,Psharp}{Pending}{\prespace{1}}\mdToken{Operator,Psharp}{=}{\prespace{1}}\mdToken{Keyword,Psharp}{new}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{Dictionary}\mdToken{Operator,Psharp}{{\textless}}\mdToken{Keyword,Psharp}{machine}\mdToken{Delimiter,Psharp}{,}{\prespace{1}}\mdToken{Keyword,Psharp}{int}\mdToken{Operator,Psharp}{{\textgreater}}\mdToken{Delimiter,Parenthesis,Psharp,BracketOpen}{(}\mdToken{Delimiter,Parenthesis,Psharp,BracketClose}{)}\mdToken{Delimiter,Psharp}{;}\prebr{}
{\preindent{6}}\mdToken{Delimiter,Curly,Psharp,BracketClose}{\}}\prebr{}
{\preindent{6}}\prebr{}
{\preindent{6}}\mdToken{Keyword,Psharp}{on}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{MPing}{\prespace{1}}\mdToken{Keyword,Psharp}{do}{\prespace{1}}\mdToken{Delimiter,Curly,Psharp,BracketOpen}{\{}\prebr{}
{\preindent{8}}\mdToken{Keyword,Psharp}{if}{\prespace{1}}\mdToken{Delimiter,Parenthesis,Psharp,BracketOpen}{(}\mdToken{Operator,Psharp}{!}\mdToken{Keyword,Psharp}{this}\mdToken{Delimiter,Psharp}{.}\mdToken{Type,Identifier,Psharp}{Pending}\mdToken{Delimiter,Psharp}{.}\mdToken{Type,Identifier,Psharp}{ContainsKey}\mdToken{Delimiter,Parenthesis,Psharp,BracketOpen}{(}\mdToken{Delimiter,Parenthesis,Psharp,BracketOpen}{(}\mdToken{Keyword,Psharp}{machine}\mdToken{Delimiter,Parenthesis,Psharp,BracketClose}{)}\mdToken{Keyword,Psharp}{payload}\mdToken{Delimiter,Parenthesis,Psharp,BracketClose}{)}\mdToken{Delimiter,Parenthesis,Psharp,BracketClose}{)}{\prespace{1}}\mdToken{Delimiter,Curly,Psharp,BracketOpen}{\{}\prebr{}
{\preindent{10}}\mdToken{Keyword,Psharp}{this}\mdToken{Delimiter,Psharp}{.}\mdToken{Type,Identifier,Psharp}{Pending}\mdToken{Delimiter,Square,Psharp,BracketOpen}{[}\mdToken{Delimiter,Parenthesis,Psharp,BracketOpen}{(}\mdToken{Keyword,Psharp}{machine}\mdToken{Delimiter,Parenthesis,Psharp,BracketClose}{)}\mdToken{Keyword,Psharp}{payload}\mdToken{Delimiter,Square,Psharp,BracketClose}{]}{\prespace{1}}\mdToken{Operator,Psharp}{=}{\prespace{1}}\mdToken{Number,Psharp}{0}\mdToken{Delimiter,Psharp}{;}\prebr{}
{\preindent{8}}\mdToken{Delimiter,Curly,Psharp,BracketClose}{\}}\prebr{}
{\preindent{8}}\prebr{}
{\preindent{8}}\mdToken{Keyword,Psharp}{this}\mdToken{Delimiter,Psharp}{.}\mdToken{Type,Identifier,Psharp}{Pending}\mdToken{Delimiter,Square,Psharp,BracketOpen}{[}\mdToken{Delimiter,Parenthesis,Psharp,BracketOpen}{(}\mdToken{Keyword,Psharp}{machine}\mdToken{Delimiter,Parenthesis,Psharp,BracketClose}{)}\mdToken{Keyword,Psharp}{payload}\mdToken{Delimiter,Square,Psharp,BracketClose}{]}{\prespace{1}}\mdToken{Operator,Psharp}{=}{\prespace{1}}\mdToken{Keyword,Psharp}{this}\mdToken{Delimiter,Psharp}{.}\mdToken{Type,Identifier,Psharp}{Pending}\mdToken{Delimiter,Square,Psharp,BracketOpen}{[}\mdToken{Delimiter,Parenthesis,Psharp,BracketOpen}{(}\mdToken{Keyword,Psharp}{machine}\mdToken{Delimiter,Parenthesis,Psharp,BracketClose}{)}\mdToken{Keyword,Psharp}{payload}\mdToken{Delimiter,Square,Psharp,BracketClose}{]}{\prespace{1}}\mdToken{Operator,Psharp}{+}{\prespace{1}}\mdToken{Number,Psharp}{1}\mdToken{Delimiter,Psharp}{;}\prebr{}
{\preindent{8}}\mdToken{Keyword,Psharp}{assert}{\prespace{1}}\mdToken{Delimiter,Parenthesis,Psharp,BracketOpen}{(}\mdToken{Keyword,Psharp}{this}\mdToken{Delimiter,Psharp}{.}\mdToken{Type,Identifier,Psharp}{Pending}\mdToken{Delimiter,Square,Psharp,BracketOpen}{[}\mdToken{Delimiter,Parenthesis,Psharp,BracketOpen}{(}\mdToken{Keyword,Psharp}{machine}\mdToken{Delimiter,Parenthesis,Psharp,BracketClose}{)}\mdToken{Keyword,Psharp}{payload}\mdToken{Delimiter,Square,Psharp,BracketClose}{]}{\prespace{1}}\mdToken{Operator,Psharp}{{\textless}=}{\prespace{1}}\mdToken{Number,Psharp}{3}\mdToken{Delimiter,Parenthesis,Psharp,BracketClose}{)}\mdToken{Delimiter,Psharp}{;}\prebr{}
{\preindent{6}}\mdToken{Delimiter,Curly,Psharp,BracketClose}{\}}\mdToken{Delimiter,Psharp}{;}\prebr{}
{\preindent{6}}\prebr{}
{\preindent{6}}\mdToken{Keyword,Psharp}{on}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{MPong}{\prespace{1}}\mdToken{Keyword,Psharp}{do}{\prespace{1}}\mdToken{Delimiter,Curly,Psharp,BracketOpen}{\{}\prebr{}
{\preindent{8}}\mdToken{Keyword,Psharp}{assert}{\prespace{1}}\mdToken{Delimiter,Parenthesis,Psharp,BracketOpen}{(}\mdToken{Keyword,Psharp}{this}\mdToken{Delimiter,Psharp}{.}\mdToken{Type,Identifier,Psharp}{Pending}\mdToken{Delimiter,Psharp}{.}\mdToken{Type,Identifier,Psharp}{ContainsKey}\mdToken{Delimiter,Parenthesis,Psharp,BracketOpen}{(}\mdToken{Delimiter,Parenthesis,Psharp,BracketOpen}{(}\mdToken{Keyword,Psharp}{machine}\mdToken{Delimiter,Parenthesis,Psharp,BracketClose}{)}\mdToken{Keyword,Psharp}{payload}\mdToken{Delimiter,Parenthesis,Psharp,BracketClose}{)}\mdToken{Delimiter,Parenthesis,Psharp,BracketClose}{)}\mdToken{Delimiter,Psharp}{;}\prebr{}
{\preindent{8}}\mdToken{Keyword,Psharp}{assert}{\prespace{1}}\mdToken{Delimiter,Parenthesis,Psharp,BracketOpen}{(}\mdToken{Keyword,Psharp}{this}\mdToken{Delimiter,Psharp}{.}\mdToken{Type,Identifier,Psharp}{Pending}\mdToken{Delimiter,Square,Psharp,BracketOpen}{[}\mdToken{Delimiter,Parenthesis,Psharp,BracketOpen}{(}\mdToken{Keyword,Psharp}{machine}\mdToken{Delimiter,Parenthesis,Psharp,BracketClose}{)}\mdToken{Keyword,Psharp}{payload}\mdToken{Delimiter,Square,Psharp,BracketClose}{]}{\prespace{1}}\mdToken{Operator,Psharp}{{\textgreater}}{\prespace{1}}\mdToken{Number,Psharp}{0}\mdToken{Delimiter,Parenthesis,Psharp,BracketClose}{)}\mdToken{Delimiter,Psharp}{;}\prebr{}
{\preindent{8}}\mdToken{Keyword,Psharp}{this}\mdToken{Delimiter,Psharp}{.}\mdToken{Type,Identifier,Psharp}{Pending}\mdToken{Delimiter,Square,Psharp,BracketOpen}{[}\mdToken{Delimiter,Parenthesis,Psharp,BracketOpen}{(}\mdToken{Keyword,Psharp}{machine}\mdToken{Delimiter,Parenthesis,Psharp,BracketClose}{)}\mdToken{Keyword,Psharp}{payload}\mdToken{Delimiter,Square,Psharp,BracketClose}{]}{\prespace{1}}\mdToken{Operator,Psharp}{=}{\prespace{1}}\mdToken{Keyword,Psharp}{this}\mdToken{Delimiter,Psharp}{.}\mdToken{Type,Identifier,Psharp}{Pending}\mdToken{Delimiter,Square,Psharp,BracketOpen}{[}\mdToken{Delimiter,Parenthesis,Psharp,BracketOpen}{(}\mdToken{Keyword,Psharp}{machine}\mdToken{Delimiter,Parenthesis,Psharp,BracketClose}{)}\mdToken{Keyword,Psharp}{payload}\mdToken{Delimiter,Square,Psharp,BracketClose}{]}{\prespace{1}}\mdToken{Operator,Psharp}{-}{\prespace{1}}\mdToken{Number,Psharp}{1}\mdToken{Delimiter,Psharp}{;}\prebr{}
{\preindent{6}}\mdToken{Delimiter,Curly,Psharp,BracketClose}{\}}\mdToken{Delimiter,Psharp}{;}\prebr{}
{\preindent{4}}\mdToken{Delimiter,Curly,Psharp,BracketClose}{\}}\prebr{}
{\preindent{2}}\mdToken{Delimiter,Curly,Psharp,BracketClose}{\}}\prebr{}
\mdToken{Delimiter,Curly,Psharp,BracketClose}{\}}}%mdk
\end{mdPre}%mdk
\begin{mdP}[data-line={621}]%mdk
%mdk-data-line={621}
{}P%mdk-data-line={621}
{}\#%mdk-data-line={621}
{} also allows programmers to write %mdk-data-line={621}
{}\mdEm{assertions}%mdk-data-line={621}
{} that express invariants on the local
state of a machine. This can be achieved using the %mdk-data-line={622}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Keyword,Psharp}{assert}}%mdk-data-line={622}
{} statement.
However, it is often useful to be able to write assertions about state across
machines in a program. P%mdk-data-line={624}
{}\#%mdk-data-line={624}
{} provides %mdk-data-line={624}
{}\mdEm{monitors}%mdk-data-line={624}
{} that enable writting such specifications.
Consider the problem of specifying that the difference in the number of %mdk-data-line={625}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{Ping}}%mdk-data-line={625}
{}
events sent to any machine can never be three more than the number of %mdk-data-line={626}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{Pong}}%mdk-data-line={626}
{} events
sent by it.
This specification can be encoded using the monitor machine %mdk-data-line={628}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{Safety}}%mdk-data-line={628}
{}. This monitor
maintains the difference between the number of %mdk-data-line={629}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{Ping}}%mdk-data-line={629}
{} and %mdk-data-line={629}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{Pong}}%mdk-data-line={629}
{} events per machine
in a C%mdk-data-line={630}
{}\#%mdk-data-line={630}
{} dictionary and asserts that this number can be at most three.
The failure detection protocol communicates with this monitor by sending it %mdk-data-line={631}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{MPing}}%mdk-data-line={631}
{}
and %mdk-data-line={632}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{MPong}}%mdk-data-line={632}
{} events using a statement such as %mdk-data-line={632}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Keyword,Psharp}{monitor}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{Safety}\mdToken{Delimiter,Psharp}{,}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{MPong}{\prespace{1}}\mdToken{Delimiter,Parenthesis,Psharp,BracketOpen}{(}{\prespace{1}}\mdToken{Keyword,Psharp}{this}{\prespace{1}}\mdToken{Delimiter,Parenthesis,Psharp,BracketClose}{)}}%mdk-data-line={632}
{}.%mdk
\end{mdP}%mdk
\mdHxxx[id=sec-test-driver-machine,label={[3.4]\{.heading-label\}},toc={},font-weight={normal},data-line={634},caption={[[3.4]\{.heading-label\}.{\hspace*{0.5em}}]\{.heading-before\}Test driver machine},bookmark={3.4.{\hspace*{0.5em}}Test driver machine}]{%mdk-data-line={634}
{}\mdSpan[class={heading-before}]{\mdSpan[class={heading-label}]{3.4}.{\hspace*{0.5em}}}%mdk-data-line={634}
{}Test driver machine}\begin{mdP}[data-line={636}]%mdk
%mdk-data-line={636}
{}The machine %mdk-data-line={636}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{Driver}}%mdk-data-line={636}
{} shows how to write a test driver to test the failure detection
protocol. This machine models a client of the protocol. This client creates a few
nodes to be monitored, creates an instance of the %mdk-data-line={638}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{Safety}}%mdk-data-line={638}
{} monitor, an instance of
%mdk-data-line={639}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{FailureDetector}}%mdk-data-line={639}
{}, registers itself with the created instance of %mdk-data-line={639}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{FailureDetector}}%mdk-data-line={639}
{},
and then enqueues the special %mdk-data-line={640}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Keyword,Psharp}{halt}}%mdk-data-line={640}
{} event to each node created by it to terminate
that node. Thus, the %mdk-data-line={641}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{Driver}}%mdk-data-line={641}
{} machine creates a finite test program for the failure
detection protocol.%mdk
\end{mdP}%mdk
\begin{mdPre}[class={para-block,pre-fenced,pre-fenced3,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp},data-line={644},data-line-code={645}]%mdk
\mdPrecode[data-line={645}]{\mdToken{Comment,Psharp}{//\prespace{1}Driver.psharp}\prebr{}
\mdToken{Keyword,Psharp}{namespace}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{FailureDetector}{\prespace{1}}\mdToken{Delimiter,Curly,Psharp,BracketOpen}{\{}\prebr{}
{\preindent{2}}\mdToken{Keyword,Psharp}{model}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{Driver}{\prespace{1}}\mdToken{Delimiter,Curly,Psharp,BracketOpen}{\{}\prebr{}
{\preindent{4}}\mdToken{Keyword,Psharp}{machine}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{FailureDetector}\mdToken{Delimiter,Psharp}{;}\prebr{}
{\preindent{4}}\mdToken{Type,Identifier,Psharp}{List}\mdToken{Operator,Psharp}{{\textless}}\mdToken{Keyword,Psharp}{machine}\mdToken{Operator,Psharp}{{\textgreater}}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{NodeSeq}\mdToken{Delimiter,Psharp}{;}\prebr{}
{\preindent{4}}\mdToken{Type,Identifier,Psharp}{Dictionary}\mdToken{Operator,Psharp}{{\textless}}\mdToken{Keyword,Psharp}{machine}\mdToken{Delimiter,Psharp}{,}{\prespace{1}}\mdToken{Keyword,Psharp}{bool}\mdToken{Operator,Psharp}{{\textgreater}}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{NodeMap}\mdToken{Delimiter,Psharp}{;}\prebr{}
{\preindent{4}}\prebr{}
{\preindent{4}}\mdToken{Keyword,Psharp}{start}{\prespace{1}}\mdToken{Keyword,Psharp}{state}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{Init}{\prespace{1}}\mdToken{Delimiter,Curly,Psharp,BracketOpen}{\{}\prebr{}
{\preindent{6}}\mdToken{Keyword,Psharp}{entry}{\prespace{1}}\mdToken{Delimiter,Curly,Psharp,BracketOpen}{\{}\prebr{}
{\preindent{8}}\mdToken{Keyword,Psharp}{this}\mdToken{Delimiter,Psharp}{.}\mdToken{Type,Identifier,Psharp}{NodeSeq}{\prespace{1}}\mdToken{Operator,Psharp}{=}{\prespace{1}}\mdToken{Keyword,Psharp}{new}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{List}\mdToken{Operator,Psharp}{{\textless}}\mdToken{Keyword,Psharp}{machine}\mdToken{Operator,Psharp}{{\textgreater}}\mdToken{Delimiter,Parenthesis,Psharp,BracketOpen}{(}\mdToken{Delimiter,Parenthesis,Psharp,BracketClose}{)}\mdToken{Delimiter,Psharp}{;}\prebr{}
{\preindent{8}}\mdToken{Keyword,Psharp}{this}\mdToken{Delimiter,Psharp}{.}\mdToken{Type,Identifier,Psharp}{NodeMap}{\prespace{1}}\mdToken{Operator,Psharp}{=}{\prespace{1}}\mdToken{Keyword,Psharp}{new}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{Dictionary}\mdToken{Operator,Psharp}{{\textless}}\mdToken{Keyword,Psharp}{machine}\mdToken{Delimiter,Psharp}{,}{\prespace{1}}\mdToken{Keyword,Psharp}{bool}\mdToken{Operator,Psharp}{{\textgreater}}\mdToken{Delimiter,Parenthesis,Psharp,BracketOpen}{(}\mdToken{Delimiter,Parenthesis,Psharp,BracketClose}{)}\mdToken{Delimiter,Psharp}{;}\prebr{}
{\preindent{8}}\mdToken{Keyword,Psharp}{this}\mdToken{Delimiter,Psharp}{.}\mdToken{Type,Identifier,Psharp}{Initialize}\mdToken{Delimiter,Parenthesis,Psharp,BracketOpen}{(}\mdToken{Delimiter,Parenthesis,Psharp,BracketClose}{)}\mdToken{Delimiter,Psharp}{;}\prebr{}
{\preindent{8}}\mdToken{Keyword,Psharp}{create}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{Safety}{\prespace{1}}\mdToken{Delimiter,Parenthesis,Psharp,BracketOpen}{(}\mdToken{Delimiter,Parenthesis,Psharp,BracketClose}{)}\mdToken{Delimiter,Psharp}{;}\prebr{}
{\preindent{8}}\mdToken{Keyword,Psharp}{this}\mdToken{Delimiter,Psharp}{.}\mdToken{Type,Identifier,Psharp}{FailureDetector}{\prespace{1}}\mdToken{Operator,Psharp}{=}{\prespace{1}}\mdToken{Keyword,Psharp}{create}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{FailureDetector}{\prespace{1}}\mdToken{Delimiter,Parenthesis,Psharp,BracketOpen}{(}{\prespace{1}}\mdToken{Keyword,Psharp}{this}\mdToken{Delimiter,Psharp}{.}\mdToken{Type,Identifier,Psharp}{NodeSeq}{\prespace{1}}\mdToken{Delimiter,Parenthesis,Psharp,BracketClose}{)}\mdToken{Delimiter,Psharp}{;}\prebr{}
{\preindent{8}}\mdToken{Keyword,Psharp}{send}{\prespace{1}}\mdToken{Keyword,Psharp}{this}\mdToken{Delimiter,Psharp}{.}\mdToken{Type,Identifier,Psharp}{FailureDetector}\mdToken{Delimiter,Psharp}{,}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{RegisterClient}{\prespace{1}}\mdToken{Delimiter,Parenthesis,Psharp,BracketOpen}{(}{\prespace{1}}\mdToken{Keyword,Psharp}{this}{\prespace{1}}\mdToken{Delimiter,Parenthesis,Psharp,BracketClose}{)}\mdToken{Delimiter,Psharp}{;}\prebr{}
{\preindent{8}}\mdToken{Keyword,Psharp}{this}\mdToken{Delimiter,Psharp}{.}\mdToken{Type,Identifier,Psharp}{Fail}\mdToken{Delimiter,Parenthesis,Psharp,BracketOpen}{(}\mdToken{Delimiter,Parenthesis,Psharp,BracketClose}{)}\mdToken{Delimiter,Psharp}{;}\prebr{}
{\preindent{6}}\mdToken{Delimiter,Curly,Psharp,BracketClose}{\}}\prebr{}
{\preindent{4}}\mdToken{Delimiter,Curly,Psharp,BracketClose}{\}}\prebr{}
{\preindent{4}}\prebr{}
{\preindent{4}}\mdToken{Keyword,Psharp}{void}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{Initialize}\mdToken{Delimiter,Parenthesis,Psharp,BracketOpen}{(}\mdToken{Delimiter,Parenthesis,Psharp,BracketClose}{)}{\prespace{1}}\mdToken{Delimiter,Curly,Psharp,BracketOpen}{\{}\prebr{}
{\preindent{6}}\mdToken{Keyword,Psharp}{for}{\prespace{1}}\mdToken{Delimiter,Parenthesis,Psharp,BracketOpen}{(}\mdToken{Keyword,Psharp}{int}{\prespace{1}}\mdToken{Identifier,Psharp}{i}{\prespace{1}}\mdToken{Operator,Psharp}{=}{\prespace{1}}\mdToken{Number,Psharp}{0}\mdToken{Delimiter,Psharp}{;}{\prespace{1}}\mdToken{Identifier,Psharp}{i}{\prespace{1}}\mdToken{Operator,Psharp}{{\textless}}{\prespace{1}}\mdToken{Number,Psharp}{2}\mdToken{Delimiter,Psharp}{;}{\prespace{1}}\mdToken{Identifier,Psharp}{i}++\mdToken{Delimiter,Parenthesis,Psharp,BracketClose}{)}{\prespace{1}}\mdToken{Delimiter,Curly,Psharp,BracketOpen}{\{}\prebr{}
{\preindent{8}}\mdToken{Keyword,Psharp}{var}{\prespace{1}}\mdToken{Identifier,Psharp}{node}{\prespace{1}}\mdToken{Operator,Psharp}{=}{\prespace{1}}\mdToken{Keyword,Psharp}{create}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{Node}{\prespace{1}}\mdToken{Delimiter,Parenthesis,Psharp,BracketOpen}{(}\mdToken{Delimiter,Parenthesis,Psharp,BracketClose}{)}\mdToken{Delimiter,Psharp}{;}\prebr{}
{\preindent{8}}\mdToken{Keyword,Psharp}{this}\mdToken{Delimiter,Psharp}{.}\mdToken{Type,Identifier,Psharp}{NodeSeq}\mdToken{Delimiter,Psharp}{.}\mdToken{Type,Identifier,Psharp}{Add}\mdToken{Delimiter,Parenthesis,Psharp,BracketOpen}{(}\mdToken{Identifier,Psharp}{node}\mdToken{Delimiter,Parenthesis,Psharp,BracketClose}{)}\mdToken{Delimiter,Psharp}{;}\prebr{}
{\preindent{8}}\mdToken{Keyword,Psharp}{this}\mdToken{Delimiter,Psharp}{.}\mdToken{Type,Identifier,Psharp}{NodeMap}\mdToken{Delimiter,Psharp}{.}\mdToken{Type,Identifier,Psharp}{Add}\mdToken{Delimiter,Parenthesis,Psharp,BracketOpen}{(}\mdToken{Identifier,Psharp}{node}\mdToken{Delimiter,Psharp}{,}{\prespace{1}}\mdToken{Keyword,Psharp}{true}\mdToken{Delimiter,Parenthesis,Psharp,BracketClose}{)}\mdToken{Delimiter,Psharp}{;}\prebr{}
{\preindent{6}}\mdToken{Delimiter,Curly,Psharp,BracketClose}{\}}\prebr{}
{\preindent{4}}\mdToken{Delimiter,Curly,Psharp,BracketClose}{\}}\prebr{}
{\preindent{4}}\prebr{}
{\preindent{4}}\mdToken{Keyword,Psharp}{void}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{Fail}\mdToken{Delimiter,Parenthesis,Psharp,BracketOpen}{(}\mdToken{Delimiter,Parenthesis,Psharp,BracketClose}{)}{\prespace{1}}\mdToken{Delimiter,Curly,Psharp,BracketOpen}{\{}\prebr{}
{\preindent{6}}\mdToken{Keyword,Psharp}{for}{\prespace{1}}\mdToken{Delimiter,Parenthesis,Psharp,BracketOpen}{(}\mdToken{Keyword,Psharp}{int}{\prespace{1}}\mdToken{Identifier,Psharp}{i}{\prespace{1}}\mdToken{Operator,Psharp}{=}{\prespace{1}}\mdToken{Number,Psharp}{0}\mdToken{Delimiter,Psharp}{;}{\prespace{1}}\mdToken{Identifier,Psharp}{i}{\prespace{1}}\mdToken{Operator,Psharp}{{\textless}}{\prespace{1}}\mdToken{Number,Psharp}{2}\mdToken{Delimiter,Psharp}{;}{\prespace{1}}\mdToken{Identifier,Psharp}{i}++\mdToken{Delimiter,Parenthesis,Psharp,BracketClose}{)}{\prespace{1}}\mdToken{Delimiter,Curly,Psharp,BracketOpen}{\{}\prebr{}
{\preindent{8}}\mdToken{Keyword,Psharp}{send}{\prespace{1}}\mdToken{Keyword,Psharp}{this}\mdToken{Delimiter,Psharp}{.}\mdToken{Type,Identifier,Psharp}{NodeSeq}\mdToken{Delimiter,Square,Psharp,BracketOpen}{[}\mdToken{Identifier,Psharp}{i}\mdToken{Delimiter,Square,Psharp,BracketClose}{]}\mdToken{Delimiter,Psharp}{,}{\prespace{1}}\mdToken{Keyword,Psharp}{halt}\mdToken{Delimiter,Psharp}{;}\prebr{}
{\preindent{6}}\mdToken{Delimiter,Curly,Psharp,BracketClose}{\}}\prebr{}
{\preindent{4}}\mdToken{Delimiter,Curly,Psharp,BracketClose}{\}}\prebr{}
{\preindent{2}}\mdToken{Delimiter,Curly,Psharp,BracketClose}{\}}\prebr{}
{\preindent{2}}\prebr{}
{\preindent{2}}\mdToken{Keyword,Psharp}{public}{\prespace{1}}\mdToken{Keyword,Psharp}{class}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{Test}{\prespace{1}}\mdToken{Delimiter,Curly,Psharp,BracketOpen}{\{}\prebr{}
{\preindent{4}}\mdToken{Keyword,Psharp}{static}{\prespace{1}}\mdToken{Keyword,Psharp}{void}{\prespace{1}}\mdToken{Type,Identifier,Psharp}{Main}\mdToken{Delimiter,Parenthesis,Psharp,BracketOpen}{(}\mdToken{Keyword,Psharp}{string}\mdToken{Delimiter,Square,Psharp,BracketOpen}{[}\mdToken{Delimiter,Square,Psharp,BracketClose}{]}{\prespace{1}}\mdToken{Identifier,Psharp}{args}\mdToken{Delimiter,Parenthesis,Psharp,BracketClose}{)}{\prespace{1}}\mdToken{Delimiter,Curly,Psharp,BracketOpen}{\{}\prebr{}
{\preindent{6}}\mdToken{Type,Identifier,Psharp}{PSharpRuntime}\mdToken{Delimiter,Psharp}{.}\mdToken{Type,Identifier,Psharp}{CreateMachine}\mdToken{Delimiter,Parenthesis,Psharp,BracketOpen}{(}\mdToken{Keyword,Psharp}{typeof}\mdToken{Delimiter,Parenthesis,Psharp,BracketOpen}{(}\mdToken{Type,Identifier,Psharp}{Driver}\mdToken{Delimiter,Parenthesis,Psharp,BracketClose}{)}\mdToken{Delimiter,Parenthesis,Psharp,BracketClose}{)}\mdToken{Delimiter,Psharp}{;}\prebr{}
{\preindent{6}}\mdToken{Type,Identifier,Psharp}{Console}\mdToken{Delimiter,Psharp}{.}\mdToken{Type,Identifier,Psharp}{ReadLine}\mdToken{Delimiter,Parenthesis,Psharp,BracketOpen}{(}\mdToken{Delimiter,Parenthesis,Psharp,BracketClose}{)}\mdToken{Delimiter,Psharp}{;}\prebr{}
{\preindent{4}}\mdToken{Delimiter,Curly,Psharp,BracketClose}{\}}\prebr{}
{\preindent{2}}\mdToken{Delimiter,Curly,Psharp,BracketClose}{\}}\prebr{}
\mdToken{Delimiter,Curly,Psharp,BracketClose}{\}}}%mdk
\end{mdPre}%mdk
\begin{mdP}[data-line={688}]%mdk
%mdk-data-line={688}
{}Even though the test program encoded by machine %mdk-data-line={688}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{Driver}}%mdk-data-line={688}
{} is finite, it can generate
an enormous number of behaviors resulting primarily from the concurrent execution
of a number of state machines: one %mdk-data-line={690}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{Driver}}%mdk-data-line={690}
{} machine, two %mdk-data-line={690}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{Node}}%mdk-data-line={690}
{} machines, one
%mdk-data-line={691}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{FailureDetector}}%mdk-data-line={691}
{} machine, and one %mdk-data-line={691}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{Timer}}%mdk-data-line={691}
{} machine.
At each step in an execution when a non-local action (creation of a machine or
sending an event from one machine to another) is about to execute, there is a choice
of picking %mdk-data-line={694}
{}\mdEm{any}%mdk-data-line={694}
{} one of these machines to execute. 
The testing infrastructure embedded in the P%mdk-data-line={695}
{}\#%mdk-data-line={695}
{} compiler %mdk-data-line={695}
{}\mdEm{systematically enumerates}%mdk-data-line={695}
{}
these behaviors; if an exception is raised or an assertion is violated, a path to
the error is reported to the programmer.%mdk
\end{mdP}%mdk
\begin{mdP}[class={indent},data-line={699}]%mdk
%mdk-data-line={699}
{}The style of specifying test programs in the manner described above results in a
compact description of a large set of test executions, considerably reducing the
programmer%mdk-data-line={701}
{}{'}%mdk-data-line={701}
{}s effort in specifying and generating them.
For example, even though the %mdk-data-line={702}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{Driver}}%mdk-data-line={702}
{} machine sends a %mdk-data-line={702}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Keyword,Psharp}{halt}}%mdk-data-line={702}
{} event to each %mdk-data-line={702}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{Node}}%mdk-data-line={702}
{}
machine immediately after creating them, these send actions may be arbitrarily
%mdk-data-line={704}
{}\mdEm{delayed}%mdk-data-line={704}
{} if a nondeterministic scheduler chooses to execute the other machines 
in the program instead. The P%mdk-data-line={705}
{}\#%mdk-data-line={705}
{} systematic tester has the capability to enumerate
such behaviors to explore %mdk-data-line={706}
{}\mdEm{tricky}%mdk-data-line={706}
{} interleavings between event handlers.%mdk
\end{mdP}%mdk
\mdHxx[id=sec-tools,label={[4]\{.heading-label\}},toc={},font-weight={normal},data-line={708},caption={[[4]\{.heading-label\}.{\hspace*{0.5em}}]\{.heading-before\}Tools},bookmark={4.{\hspace*{0.5em}}Tools}]{%mdk-data-line={708}
{}\mdSpan[class={heading-before}]{\mdSpan[class={heading-label}]{4}.{\hspace*{0.5em}}}%mdk-data-line={708}
{}Tools}\begin{mdP}[data-line={710}]%mdk
%mdk-data-line={710}
{}\mdImg[width={auto},max-width={0.90\linewidth},data-linkid={workflow}]{images/workflow.pdf}%mdk-data-line={710}
{}%mdk
\end{mdP}%mdk
\begin{mdP}[class={indent},data-line={712}]%mdk
%mdk-data-line={712}
{}The above figure shows a typical P%mdk-data-line={712}
{}\#%mdk-data-line={712}
{} workflow. The programmer initially creates a P%mdk-data-line={712}
{}\#%mdk-data-line={712}
{}
application and then uses the compiler to parse, compile and systematically test this
application. This process repeats until all bugs are discovered and fixed.%mdk
\end{mdP}%mdk
\mdHxxx[id=sec-compilation,label={[4.1]\{.heading-label\}},toc={},font-weight={normal},data-line={716},caption={[[4.1]\{.heading-label\}.{\hspace*{0.5em}}]\{.heading-before\}Compilation},bookmark={4.1.{\hspace*{0.5em}}Compilation}]{%mdk-data-line={716}
{}\mdSpan[class={heading-before}]{\mdSpan[class={heading-label}]{4.1}.{\hspace*{0.5em}}}%mdk-data-line={716}
{}Compilation}\begin{mdP}[data-line={718}]%mdk
%mdk-data-line={718}
{}The compiler executable is called %mdk-data-line={718}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{PSharpCompiler}\mdToken{Delimiter,Psharp}{.}\mdToken{Identifier,Psharp}{exe}}%mdk-data-line={718}
{}. It accepts a P%mdk-data-line={718}
{}\#%mdk-data-line={718}
{} solution, which
can contain a number of %mdk-data-line={719}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Delimiter,Psharp}{.}\mdToken{Identifier,Psharp}{psharp}}%mdk-data-line={719}
{} and %mdk-data-line={719}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Delimiter,Psharp}{.}\mdToken{Identifier,Psharp}{cs}}%mdk-data-line={719}
{} files, and various optional arguments as
input. The options can be discovered by running %mdk-data-line={720}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{PSharpCompiler}\mdToken{Delimiter,Psharp}{.}\mdToken{Identifier,Psharp}{exe}{\prespace{1}}\mdToken{Operator,Psharp}{/}\mdToken{Source,Psharp}{?}}%mdk-data-line={720}
{} from the command
line.%mdk
\end{mdP}%mdk
\begin{mdP}[class={indent},data-line={723}]%mdk
%mdk-data-line={723}
{}The compiler is based on a three-phase compilation approach: it initially parses the
P%mdk-data-line={724}
{}\#%mdk-data-line={724}
{} surface syntax and reports any P%mdk-data-line={724}
{}\#%mdk-data-line={724}
{}-related syntax errors; it then rewrites the
original P%mdk-data-line={725}
{}\#%mdk-data-line={725}
{} program into an intermediate C%mdk-data-line={725}
{}\#%mdk-data-line={725}
{} representation; it finally uses the Roslyn
compiler to parse and compile the intermediate C%mdk-data-line={726}
{}\#%mdk-data-line={726}
{} program to an executable file (%mdk-data-line={726}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Delimiter,Psharp}{.}\mdToken{Identifier,Psharp}{exe}}%mdk-data-line={726}
{})
or library (%mdk-data-line={727}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Delimiter,Psharp}{.}\mdToken{Identifier,Psharp}{dll}}%mdk-data-line={727}
{}), and link it with the P%mdk-data-line={727}
{}\#%mdk-data-line={727}
{} libraries and C%mdk-data-line={727}
{}\#%mdk-data-line={727}
{} system libraries. Any
C%mdk-data-line={728}
{}\#%mdk-data-line={728}
{}-specific compile errors will be reported in this final Roslyn-based compilation phase.%mdk
\end{mdP}%mdk
\begin{mdP}[class={indent},data-line={730}]%mdk
%mdk-data-line={730}
{}The P%mdk-data-line={730}
{}\#%mdk-data-line={730}
{} compiler can be invoked on a P%mdk-data-line={730}
{}\#%mdk-data-line={730}
{} solution with the following command:%mdk
\end{mdP}%mdk
\begin{mdPre}[class={para-block,pre-fenced,pre-fenced3,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp},data-line={732},data-line-code={733}]%mdk
\mdPrecode[data-line={733}]{\mdToken{Delimiter,Psharp}{.}\mdToken{Source,Psharp}{{\textbackslash}}\mdToken{Type,Identifier,Psharp}{PSharpCompiler}\mdToken{Delimiter,Psharp}{.}\mdToken{Identifier,Psharp}{exe}{\prespace{1}}\mdToken{Operator,Psharp}{/}\mdToken{Identifier,Psharp}{s}:\$\mdToken{Delimiter,Curly,Psharp,BracketOpen}{\{}\mdToken{Type,Identifier,Psharp}{SOLUTION\_PATH}\mdToken{Delimiter,Curly,Psharp,BracketClose}{\}}\mdToken{Source,Psharp}{{\textbackslash}}\mdToken{Identifier,Psharp}{\$}\mdToken{Delimiter,Curly,Psharp,BracketOpen}{\{}\mdToken{Type,Identifier,Psharp}{SOLUTION\_NAME}\mdToken{Delimiter,Curly,Psharp,BracketClose}{\}}\mdToken{Delimiter,Psharp}{.}\mdToken{Identifier,Psharp}{sln}}%mdk
\end{mdPre}%mdk
\begin{mdP}[data-line={736}]%mdk
%mdk-data-line={736}
{}To build only a single specific project from a given solution use the %mdk-data-line={736}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Operator,Psharp}{/}\mdToken{Identifier,Psharp}{p}:\$\mdToken{Delimiter,Curly,Psharp,BracketOpen}{\{}\mdToken{Type,Identifier,Psharp}{PROJECT\_NAME}\mdToken{Delimiter,Curly,Psharp,BracketClose}{\}}}%mdk-data-line={736}
{} command
line option.%mdk
\end{mdP}%mdk
\mdHxxx[id=sec-execution,label={[4.2]\{.heading-label\}},toc={},font-weight={normal},data-line={739},caption={[[4.2]\{.heading-label\}.{\hspace*{0.5em}}]\{.heading-before\}Execution},bookmark={4.2.{\hspace*{0.5em}}Execution}]{%mdk-data-line={739}
{}\mdSpan[class={heading-before}]{\mdSpan[class={heading-label}]{4.2}.{\hspace*{0.5em}}}%mdk-data-line={739}
{}Execution}\begin{mdP}[data-line={741}]%mdk
%mdk-data-line={741}
{}To execute the compiled program, run the executable that is produced by %mdk-data-line={741}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Type,Identifier,Psharp}{PSharpCompiler}\mdToken{Delimiter,Psharp}{.}\mdToken{Identifier,Psharp}{exe}}%mdk-data-line={741}
{}
(found in the directory specified by the P%mdk-data-line={742}
{}\#%mdk-data-line={742}
{} project). If the compiled program is a library,
then link the library as in any typical .NET project.
A typical P%mdk-data-line={744}
{}\#%mdk-data-line={744}
{} application consists of one or more P%mdk-data-line={744}
{}\#%mdk-data-line={744}
{} machines communicating asynchronously
with each other by sending and receiving events. The P%mdk-data-line={745}
{}\#%mdk-data-line={745}
{} runtime is responsible for handling
all the underlying asynchrony when a machine creates a new machine or sends an event to a
target machine.%mdk
\end{mdP}%mdk
\mdHxxx[id=sec-systematic-testing,label={[4.3]\{.heading-label\}},toc={},font-weight={normal},data-line={749},caption={[[4.3]\{.heading-label\}.{\hspace*{0.5em}}]\{.heading-before\}Systematic Testing},bookmark={4.3.{\hspace*{0.5em}}Systematic Testing}]{%mdk-data-line={749}
{}\mdSpan[class={heading-before}]{\mdSpan[class={heading-label}]{4.3}.{\hspace*{0.5em}}}%mdk-data-line={749}
{}Systematic Testing}\begin{mdP}[data-line={751}]%mdk
%mdk-data-line={751}
{}Once the programmer fixes all the statically discovered errors, the compiler can be used
to systematically test the P%mdk-data-line={752}
{}\#%mdk-data-line={752}
{} application. This is achieved by running the compiler in
%mdk-data-line={753}
{}\mdEm{bug-finding}%mdk-data-line={753}
{} mode. In this mode, the systematic tester takes control of the underlying
schedule and systematically explores event handling interleavings to discover bugs in the
P%mdk-data-line={755}
{}\#%mdk-data-line={755}
{} program.%mdk
\end{mdP}%mdk
\begin{mdP}[class={indent},data-line={757}]%mdk
%mdk-data-line={757}
{}To switch to bug-finding mode the command-line option %mdk-data-line={757}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Operator,Psharp}{/}\mdToken{Identifier,Psharp}{test}}%mdk-data-line={757}
{} must be given when invoking
the P%mdk-data-line={758}
{}\#%mdk-data-line={758}
{} compiler.%mdk
\end{mdP}%mdk
\begin{mdP}[class={indent},data-line={760}]%mdk
%mdk-data-line={760}
{}By default, the systematic tester will explore a single iteration using an exploration
depth bound of 1000. This depth bound is the maximum number of scheduling steps that
the systematic tester will take while exploring a single schedule of the program. To
increase the depth bound use the command line option %mdk-data-line={763}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Operator,Psharp}{/}\mdToken{Identifier,Psharp}{db}\mdToken{Operator,Psharp}{:}\mdToken{Identifier,Psharp}{x}}%mdk-data-line={763}
{} where %mdk-data-line={763}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Identifier,Psharp}{x}}%mdk-data-line={763}
{} is a positive
integer. To increase the number of schedules to be explored (from program start to a
terminal state) use the command line option %mdk-data-line={765}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Operator,Psharp}{/}\mdToken{Identifier,Psharp}{i}\mdToken{Operator,Psharp}{:}\mdToken{Identifier,Psharp}{x}}%mdk-data-line={765}
{} where %mdk-data-line={765}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Identifier,Psharp}{x}}%mdk-data-line={765}
{} is a positive integer.%mdk
\end{mdP}%mdk
\begin{mdP}[class={indent},data-line={767}]%mdk
%mdk-data-line={767}
{}If a dynamic error is discovered, the systematic testing will terminate, and a complete
error trace starting from the initial state of the program is dumped on the disk in a
text file (in the same directory as the compiled binaries of the P%mdk-data-line={769}
{}\#%mdk-data-line={769}
{} application). The
programmer can fix the found bug and run the compiler and systematic testing again on
the modified program. Search statistics are also printed during and at the end of the
systematic testing.%mdk
\end{mdP}%mdk
\mdHxx[id=sec-glossary,label={[5]\{.heading-label\}},toc={},font-weight={normal},data-line={774},caption={[[5]\{.heading-label\}.{\hspace*{0.5em}}]\{.heading-before\}Glossary},bookmark={5.{\hspace*{0.5em}}Glossary}]{%mdk-data-line={774}
{}\mdSpan[class={heading-before}]{\mdSpan[class={heading-label}]{5}.{\hspace*{0.5em}}}%mdk-data-line={774}
{}Glossary}\begin{mdDiv}[class={grammar},elem={grammar},data-line={776}]%mdk
\begin{mdTable}[class={grammar-table,madoko,block},th-background-color={gainsboro},data-line={777}]{2}{ll}
\midrule
\multicolumn{2}{|c|}{{\cellcolor{Gainsboro}}\mdTh[class={thead,tr-odd,tr-first,col,col-odd,col-last,col-first},elem={col},data-line={778},data-row={1},text-align={center},data-col={1},display={table-cell}]{%mdk-data-line={778}
{} Types}}\\
\multicolumn{1}{|l}{{\cellcolor{Gainsboro}}\mdTh[class={thead,tr-even,tr-last,col,col-odd,col-first},elem={col},text-align={left},data-line={779},data-row={2},data-col={1},display={table-cell}]{%mdk-data-line={779}
{} Syntax}}&\multicolumn{1}{l|}{{\cellcolor{Gainsboro}}\mdTh[class={thead,tr-even,tr-last,col,col-even,col-last},elem={col},vertical-align={top},width={0.60\linewidth},text-align={left},data-line={779},data-row={2},data-col={2},display={table-cell}]{%mdk-data-line={779}
{} Description}}\\

\midrule
\multicolumn{1}{|l}{\mdTd[class={tbody,tr-odd,tr-first,col,col-odd,col-first},elem={col},text-align={left},data-line={781},data-row={1},data-col={1},display={table-cell}]{%mdk-data-line={781}
{} %mdk-data-line={781}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Keyword,Psharp}{machine}}%mdk-data-line={781}
{}}}&\multicolumn{1}{l|}{\mdTd[class={tbody,tr-odd,tr-first,col,col-even,col-last},elem={col},vertical-align={top},width={0.60\linewidth},text-align={left},data-line={781},data-row={1},data-col={2},display={table-cell}]{%mdk-data-line={781}
{} A reference to a P%mdk-data-line={781}
{}\#%mdk-data-line={781}
{} machine.}}\\
\multicolumn{1}{|l}{\mdTd[class={tbody,tr-even,tr-last,col,col-odd,col-first},elem={col},text-align={left},data-line={782},data-row={2},data-col={1},display={table-cell}]{%mdk-data-line={782}
{} type}}&\multicolumn{1}{l|}{\mdTd[class={tbody,tr-even,tr-last,col,col-even,col-last},elem={col},vertical-align={top},width={0.60\linewidth},text-align={left},data-line={782},data-row={2},data-col={2},display={table-cell}]{%mdk-data-line={782}
{} The set of all possible C%mdk-data-line={782}
{}\#%mdk-data-line={782}
{} types (either primitive, such as %mdk-data-line={782}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Keyword,Psharp}{int}}%mdk-data-line={782}
{} and %mdk-data-line={782}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Keyword,Psharp}{bool}}%mdk-data-line={782}
{}, or custom).}}\\
\midrule
\end{mdTable}
\begin{mdTable}[class={grammar-table,madoko,block},th-background-color={gainsboro},data-line={786}]{2}{ll}
\midrule
\multicolumn{2}{|c|}{{\cellcolor{Gainsboro}}\mdTh[class={thead,tr-odd,tr-first,col,col-odd,col-last,col-first},elem={col},data-line={787},data-row={1},text-align={center},data-col={1},display={table-cell}]{%mdk-data-line={787}
{} Machines and Events}}\\
\multicolumn{1}{|l}{{\cellcolor{Gainsboro}}\mdTh[class={thead,tr-even,tr-last,col,col-odd,col-first},elem={col},text-align={left},data-line={788},data-row={2},data-col={1},display={table-cell}]{%mdk-data-line={788}
{} Syntax}}&\multicolumn{1}{l|}{{\cellcolor{Gainsboro}}\mdTh[class={thead,tr-even,tr-last,col,col-even,col-last},elem={col},vertical-align={top},width={0.60\linewidth},text-align={left},data-line={788},data-row={2},data-col={2},display={table-cell}]{%mdk-data-line={788}
{} Description}}\\

\midrule
\multicolumn{1}{|l}{\mdTd[class={tbody,tr-odd,tr-first,col,col-odd,col-first},elem={col},text-align={left},data-line={790},data-row={1},data-col={1},display={table-cell}]{%mdk-data-line={790}
{} %mdk-data-line={790}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Keyword,Psharp}{default}}%mdk-data-line={790}
{}}}&\multicolumn{1}{l|}{\mdTd[class={tbody,tr-odd,tr-first,col,col-even,col-last},elem={col},vertical-align={top},width={0.60\linewidth},text-align={left},data-line={790},data-row={1},data-col={2},display={table-cell}]{%mdk-data-line={790}
{} A pseudo-event that may be taken when no other event is triggered. Taking a %mdk-data-line={790}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Keyword,Psharp}{default}}%mdk-data-line={790}
{} event sets %mdk-data-line={790}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Keyword,Psharp}{trigger}}%mdk-data-line={790}
{} and %mdk-data-line={790}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Keyword,Psharp}{payload}}%mdk-data-line={790}
{} to null.}}\\
\multicolumn{1}{|l}{\mdTd[class={tbody,tr-even,col,col-odd,col-first},elem={col},text-align={left},data-line={791},data-row={2},data-col={1},display={table-cell}]{%mdk-data-line={791}
{} %mdk-data-line={791}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Keyword,Psharp}{halt}}%mdk-data-line={791}
{}}}&\multicolumn{1}{l|}{\mdTd[class={tbody,tr-even,col,col-even,col-last},elem={col},vertical-align={top},width={0.60\linewidth},text-align={left},data-line={791},data-row={2},data-col={2},display={table-cell}]{%mdk-data-line={791}
{} A predefined event that causes a machine to shutdown. The user implements a machine%mdk-data-line={791}
{}{'}%mdk-data-line={791}
{}s response to %mdk-data-line={791}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Keyword,Psharp}{halt}}%mdk-data-line={791}
{}. A machine is shutdown when its state stack becomes empty with %mdk-data-line={791}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Keyword,Psharp}{trigger}}%mdk-data-line={791}
{} == %mdk-data-line={791}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Keyword,Psharp}{halt}}%mdk-data-line={791}
{}.}}\\
\multicolumn{1}{|l}{\mdTd[class={tbody,tr-odd,col,col-odd,col-first},elem={col},text-align={left},data-line={792},data-row={3},data-col={1},display={table-cell}]{%mdk-data-line={792}
{} %mdk-data-line={792}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Keyword,Psharp}{event}}%mdk-data-line={792}
{} e %mdk-data-line={792}
{}[%mdk-data-line={792}
{} \{%mdk-data-line={792}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Keyword,Psharp}{assert}}%mdk-data-line={792}
{} %mdk-data-line={792}
{}{\textbar}%mdk-data-line={792}
{} %mdk-data-line={792}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Identifier,Psharp}{assume}}%mdk-data-line={792}
{}\} k];}}&\multicolumn{1}{l|}{\mdTd[class={tbody,tr-odd,col,col-even,col-last},elem={col},vertical-align={top},width={0.60\linewidth},text-align={left},data-line={792},data-row={3},data-col={2},display={table-cell}]{%mdk-data-line={792}
{} Declares an event.%mdk-data-line={792}
{}\mdSup{a}%mdk-data-line={792}
{}}}\\
\multicolumn{1}{|l}{\mdTd[class={tbody,tr-even,col,col-odd,col-first},elem={col},text-align={left},data-line={793},data-row={4},data-col={1},display={table-cell}]{%mdk-data-line={793}
{} %mdk-data-line={793}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Keyword,Psharp}{machine}}%mdk-data-line={793}
{} M %mdk-data-line={793}
{}[%mdk-data-line={793}
{} \{%mdk-data-line={793}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Keyword,Psharp}{assert}}%mdk-data-line={793}
{} %mdk-data-line={793}
{}{\textbar}%mdk-data-line={793}
{} %mdk-data-line={793}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Identifier,Psharp}{assume}}%mdk-data-line={793}
{}\} k] %mdk-data-line={793}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Delimiter,Curly,Psharp,BracketOpen}{\{}}%mdk-data-line={793}
{} %mdk-data-line={793}
{}{\dots}%mdk-data-line={793}
{} %mdk-data-line={793}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Delimiter,Curly,Psharp,BracketClose}{\}}}%mdk-data-line={793}
{}}}&\multicolumn{1}{l|}{\mdTd[class={tbody,tr-even,col,col-even,col-last},elem={col},vertical-align={top},width={0.60\linewidth},text-align={left},data-line={793},data-row={4},data-col={2},display={table-cell}]{%mdk-data-line={793}
{} Declares a machine.%mdk-data-line={793}
{}\mdSup{b}%mdk-data-line={793}
{}}}\\
\multicolumn{1}{|l}{\mdTd[class={tbody,tr-odd,col,col-odd,col-first},elem={col},text-align={left},data-line={794},data-row={5},data-col={1},display={table-cell}]{%mdk-data-line={794}
{} %mdk-data-line={794}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Keyword,Psharp}{model}}%mdk-data-line={794}
{} M %mdk-data-line={794}
{}[%mdk-data-line={794}
{} \{%mdk-data-line={794}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Keyword,Psharp}{assert}}%mdk-data-line={794}
{} %mdk-data-line={794}
{}{\textbar}%mdk-data-line={794}
{} %mdk-data-line={794}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Identifier,Psharp}{assume}}%mdk-data-line={794}
{}\} k] %mdk-data-line={794}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Delimiter,Curly,Psharp,BracketOpen}{\{}}%mdk-data-line={794}
{} %mdk-data-line={794}
{}{\dots}%mdk-data-line={794}
{} %mdk-data-line={794}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Delimiter,Curly,Psharp,BracketClose}{\}}}%mdk-data-line={794}
{}}}&\multicolumn{1}{l|}{\mdTd[class={tbody,tr-odd,col,col-even,col-last},elem={col},vertical-align={top},width={0.60\linewidth},text-align={left},data-line={794},data-row={5},data-col={2},display={table-cell}]{%mdk-data-line={794}
{} Declares a model machine.%mdk-data-line={794}
{}\mdSup{b}%mdk-data-line={794}
{}}}\\
\multicolumn{1}{|l}{\mdTd[class={tbody,tr-even,tr-last,col,col-odd,col-first},elem={col},text-align={left},data-line={795},data-row={6},data-col={1},display={table-cell}]{%mdk-data-line={795}
{} %mdk-data-line={795}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Keyword,Psharp}{monitor}}%mdk-data-line={795}
{} M %mdk-data-line={795}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Delimiter,Curly,Psharp,BracketOpen}{\{}}%mdk-data-line={795}
{} %mdk-data-line={795}
{}{\dots}%mdk-data-line={795}
{} %mdk-data-line={795}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Delimiter,Curly,Psharp,BracketClose}{\}}}%mdk-data-line={795}
{}}}&\multicolumn{1}{l|}{\mdTd[class={tbody,tr-even,tr-last,col,col-even,col-last},elem={col},vertical-align={top},width={0.60\linewidth},text-align={left},data-line={795},data-row={6},data-col={2},display={table-cell}]{%mdk-data-line={795}
{} Declares a property monitor.}}\\
\midrule
\end{mdTable}
\begin{mdP}[data-line={799}]%mdk
%mdk-data-line={799}
{}\mdSup{a}%mdk-data-line={799}
{} An event e may optionally be annotated with %mdk-data-line={799}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Keyword,Psharp}{assert}{\prespace{1}}\mdToken{Identifier,Psharp}{k}}%mdk-data-line={799}
{} or %mdk-data-line={799}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Identifier,Psharp}{assume}{\prespace{1}}\mdToken{Identifier,Psharp}{k}}%mdk-data-line={799}
{}.
The former specifies that there must not be more than k instances of e in the input
queue of any machine. The latter specifies that during systematic testing, an
execution that increases the cardinality of e beyond k in some queue must not be
generated. Both compile to an assertion in code generated for execution.%mdk
\end{mdP}%mdk
\begin{mdP}[class={indent},data-line={805}]%mdk
%mdk-data-line={805}
{}\mdSup{b}%mdk-data-line={805}
{} A machine or model M may optionally be annotated with %mdk-data-line={805}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Keyword,Psharp}{assert}{\prespace{1}}\mdToken{Identifier,Psharp}{k}}%mdk-data-line={805}
{} or %mdk-data-line={805}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Identifier,Psharp}{assume}{\prespace{1}}\mdToken{Identifier,Psharp}{k}}%mdk-data-line={805}
{}.
Their meaning is similar to that of the corresponding annotation for an event except
that the bound k refers to the total number of events in the input queue of M.%mdk
\end{mdP}%mdk
\begin{mdTable}[class={grammar-table,madoko,block},th-background-color={gainsboro},data-line={810}]{2}{ll}
\midrule
\multicolumn{2}{|c|}{{\cellcolor{Gainsboro}}\mdTh[class={thead,tr-odd,tr-first,col,col-odd,col-last,col-first},elem={col},data-line={811},data-row={1},text-align={center},data-col={1},display={table-cell}]{%mdk-data-line={811}
{}States, State Variables, and Functions (declared inside machines)}}\\
\multicolumn{1}{|l}{{\cellcolor{Gainsboro}}\mdTh[class={thead,tr-even,tr-last,col,col-odd,col-first},elem={col},text-align={left},data-line={812},data-row={2},data-col={1},display={table-cell}]{%mdk-data-line={812}
{} Syntax}}&\multicolumn{1}{l|}{{\cellcolor{Gainsboro}}\mdTh[class={thead,tr-even,tr-last,col,col-even,col-last},elem={col},vertical-align={top},width={0.60\linewidth},text-align={left},data-line={812},data-row={2},data-col={2},display={table-cell}]{%mdk-data-line={812}
{} Description}}\\

\midrule
\multicolumn{1}{|l}{\mdTd[class={tbody,tr-odd,tr-first,col,col-odd,col-first},elem={col},text-align={left},data-line={814},data-row={1},data-col={1},display={table-cell}]{%mdk-data-line={814}
{} %mdk-data-line={814}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Keyword,Psharp}{this}}%mdk-data-line={814}
{}}}&\multicolumn{1}{l|}{\mdTd[class={tbody,tr-odd,tr-first,col,col-even,col-last},elem={col},vertical-align={top},width={0.60\linewidth},text-align={left},data-line={814},data-row={1},data-col={2},display={table-cell}]{%mdk-data-line={814}
{} Refers to the current instance of a machine.}}\\
\multicolumn{1}{|l}{\mdTd[class={tbody,tr-even,col,col-odd,col-first},elem={col},text-align={left},data-line={815},data-row={2},data-col={1},display={table-cell}]{%mdk-data-line={815}
{} %mdk-data-line={815}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Keyword,Psharp}{trigger}}%mdk-data-line={815}
{}}}&\multicolumn{1}{l|}{\mdTd[class={tbody,tr-even,col,col-even,col-last},elem={col},vertical-align={top},width={0.60\linewidth},text-align={left},data-line={815},data-row={2},data-col={2},display={table-cell}]{%mdk-data-line={815}
{} Refers to the event causing the current entry or exit of a state; it is initially %mdk-data-line={815}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Keyword,Psharp}{null}}%mdk-data-line={815}
{}.}}\\
\multicolumn{1}{|l}{\mdTd[class={tbody,tr-odd,col,col-odd,col-first},elem={col},text-align={left},data-line={816},data-row={3},data-col={1},display={table-cell}]{%mdk-data-line={816}
{} %mdk-data-line={816}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Keyword,Psharp}{payload}}%mdk-data-line={816}
{}}}&\multicolumn{1}{l|}{\mdTd[class={tbody,tr-odd,col,col-even,col-last},elem={col},vertical-align={top},width={0.60\linewidth},text-align={left},data-line={816},data-row={3},data-col={2},display={table-cell}]{%mdk-data-line={816}
{} Refers to the payload of the event causing entry or exit of a state; initially the value passed to the %mdk-data-line={816}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Keyword,Psharp}{create}}%mdk-data-line={816}
{} operator.}}\\
\multicolumn{1}{|l}{\mdTd[class={tbody,tr-even,col,col-odd,col-first},elem={col},text-align={left},data-line={817},data-row={4},data-col={1},display={table-cell}]{%mdk-data-line={817}
{} %mdk-data-line={817}
{}[%mdk-data-line={817}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Keyword,Psharp}{start}}%mdk-data-line={817}
{}] %mdk-data-line={817}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Keyword,Psharp}{state}}%mdk-data-line={817}
{} S %mdk-data-line={817}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Delimiter,Curly,Psharp,BracketOpen}{\{}}%mdk-data-line={817}
{} %mdk-data-line={817}
{}{\dots}%mdk-data-line={817}
{} %mdk-data-line={817}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Delimiter,Curly,Psharp,BracketClose}{\}}}%mdk-data-line={817}
{}}}&\multicolumn{1}{l|}{\mdTd[class={tbody,tr-even,col,col-even,col-last},elem={col},vertical-align={top},width={0.60\linewidth},text-align={left},data-line={817},data-row={4},data-col={2},display={table-cell}]{%mdk-data-line={817}
{} Declares a (starting) state S.}}\\
\multicolumn{1}{|l}{\mdTd[class={tbody,tr-odd,tr-last,col,col-odd,col-first},elem={col},text-align={left},data-line={818},data-row={5},data-col={1},display={table-cell}]{%mdk-data-line={818}
{} %mdk-data-line={818}
{}[%mdk-data-line={818}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Keyword,Psharp}{model}}%mdk-data-line={818}
{}] method declaration}}&\multicolumn{1}{l|}{\mdTd[class={tbody,tr-odd,tr-last,col,col-even,col-last},elem={col},vertical-align={top},width={0.60\linewidth},text-align={left},data-line={818},data-row={5},data-col={2},display={table-cell}]{%mdk-data-line={818}
{} Declares a (model) C%mdk-data-line={818}
{}\#%mdk-data-line={818}
{} method with zero or more formal parameters.}}\\
\midrule
\end{mdTable}
\begin{mdTable}[class={grammar-table,madoko,block},th-background-color={gainsboro},data-line={822}]{2}{ll}
\midrule
\multicolumn{2}{|c|}{{\cellcolor{Gainsboro}}\mdTh[class={thead,tr-odd,tr-first,col,col-odd,col-last,col-first},elem={col},data-line={823},data-row={1},text-align={center},data-col={1},display={table-cell}]{%mdk-data-line={823}
{}State Actions and Transitions (declared inside states)}}\\
\multicolumn{1}{|l}{{\cellcolor{Gainsboro}}\mdTh[class={thead,tr-even,tr-last,col,col-odd,col-first},elem={col},text-align={left},data-line={824},data-row={2},data-col={1},display={table-cell}]{%mdk-data-line={824}
{}Syntax}}&\multicolumn{1}{l|}{{\cellcolor{Gainsboro}}\mdTh[class={thead,tr-even,tr-last,col,col-even,col-last},elem={col},vertical-align={top},width={0.60\linewidth},text-align={left},data-line={824},data-row={2},data-col={2},display={table-cell}]{%mdk-data-line={824}
{} Description}}\\

\midrule
\multicolumn{1}{|l}{\mdTd[class={tbody,tr-odd,tr-first,col,col-odd,col-first},elem={col},text-align={left},data-line={826},data-row={1},data-col={1},display={table-cell}]{%mdk-data-line={826}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Keyword,Psharp}{entry}}%mdk-data-line={826}
{} A%mdk-data-line={826}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Delimiter,Psharp}{;}}%mdk-data-line={826}
{}}}&\multicolumn{1}{l|}{\mdTd[class={tbody,tr-odd,tr-first,col,col-even,col-last},elem={col},vertical-align={top},width={0.60\linewidth},text-align={left},data-line={826},data-row={1},data-col={2},display={table-cell}]{%mdk-data-line={826}
{} An action A to be executed whenever this state is entered.}}\\
\multicolumn{1}{|l}{\mdTd[class={tbody,tr-even,col,col-odd,col-first},elem={col},text-align={left},data-line={827},data-row={2},data-col={1},display={table-cell}]{%mdk-data-line={827}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Keyword,Psharp}{entry}}%mdk-data-line={827}
{} %mdk-data-line={827}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Delimiter,Curly,Psharp,BracketOpen}{\{}}%mdk-data-line={827}
{} %mdk-data-line={827}
{}{\dots}%mdk-data-line={827}
{} %mdk-data-line={827}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Delimiter,Curly,Psharp,BracketClose}{\}}}%mdk-data-line={827}
{}}}&\multicolumn{1}{l|}{\mdTd[class={tbody,tr-even,col,col-even,col-last},elem={col},vertical-align={top},width={0.60\linewidth},text-align={left},data-line={827},data-row={2},data-col={2},display={table-cell}]{%mdk-data-line={827}
{} A code block to be executed whenever this state is entered.}}\\
\multicolumn{1}{|l}{\mdTd[class={tbody,tr-odd,col,col-odd,col-first},elem={col},text-align={left},data-line={828},data-row={3},data-col={1},display={table-cell}]{%mdk-data-line={828}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Keyword,Psharp}{exit}}%mdk-data-line={828}
{} A%mdk-data-line={828}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Delimiter,Psharp}{;}}%mdk-data-line={828}
{}}}&\multicolumn{1}{l|}{\mdTd[class={tbody,tr-odd,col,col-even,col-last},elem={col},vertical-align={top},width={0.60\linewidth},text-align={left},data-line={828},data-row={3},data-col={2},display={table-cell}]{%mdk-data-line={828}
{} An action A to be executed whenever this state exits.}}\\
\multicolumn{1}{|l}{\mdTd[class={tbody,tr-even,col,col-odd,col-first},elem={col},text-align={left},data-line={829},data-row={4},data-col={1},display={table-cell}]{%mdk-data-line={829}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Keyword,Psharp}{exit}}%mdk-data-line={829}
{} %mdk-data-line={829}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Delimiter,Curly,Psharp,BracketOpen}{\{}}%mdk-data-line={829}
{} %mdk-data-line={829}
{}{\dots}%mdk-data-line={829}
{} %mdk-data-line={829}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Delimiter,Curly,Psharp,BracketClose}{\}}}%mdk-data-line={829}
{}}}&\multicolumn{1}{l|}{\mdTd[class={tbody,tr-even,col,col-even,col-last},elem={col},vertical-align={top},width={0.60\linewidth},text-align={left},data-line={829},data-row={4},data-col={2},display={table-cell}]{%mdk-data-line={829}
{} A code block to be executed whenever this state exits.}}\\
\multicolumn{1}{|l}{\mdTd[class={tbody,tr-odd,col,col-odd,col-first},elem={col},text-align={left},data-line={830},data-row={5},data-col={1},display={table-cell}]{%mdk-data-line={830}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Keyword,Psharp}{defer}}%mdk-data-line={830}
{} e%mdk-data-line={830}
{}\mdSub{1}%mdk-data-line={830}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Delimiter,Psharp}{,}}%mdk-data-line={830}
{} %mdk-data-line={830}
{}{\dots}%mdk-data-line={830}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Delimiter,Psharp}{,}}%mdk-data-line={830}
{} e%mdk-data-line={830}
{}\mdSub{n}%mdk-data-line={830}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Delimiter,Psharp}{;}}%mdk-data-line={830}
{}}}&\multicolumn{1}{l|}{\mdTd[class={tbody,tr-odd,col,col-even,col-last},elem={col},vertical-align={top},width={0.60\linewidth},text-align={left},data-line={830},data-row={5},data-col={2},display={table-cell}]{%mdk-data-line={830}
{} A list of events to skip while examining the queue for an event to handle.}}\\
\multicolumn{1}{|l}{\mdTd[class={tbody,tr-even,col,col-odd,col-first},elem={col},text-align={left},data-line={831},data-row={6},data-col={1},display={table-cell}]{%mdk-data-line={831}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Keyword,Psharp}{ignore}}%mdk-data-line={831}
{} e%mdk-data-line={831}
{}\mdSub{1}%mdk-data-line={831}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Delimiter,Psharp}{,}}%mdk-data-line={831}
{} %mdk-data-line={831}
{}{\dots}%mdk-data-line={831}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Delimiter,Psharp}{,}}%mdk-data-line={831}
{} e%mdk-data-line={831}
{}\mdSub{n}%mdk-data-line={831}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Delimiter,Psharp}{;}}%mdk-data-line={831}
{}}}&\multicolumn{1}{l|}{\mdTd[class={tbody,tr-even,col,col-even,col-last},elem={col},vertical-align={top},width={0.60\linewidth},text-align={left},data-line={831},data-row={6},data-col={2},display={table-cell}]{%mdk-data-line={831}
{} A list of events to immediately remove while examining the queue for an event to handle.}}\\
\multicolumn{1}{|l}{\mdTd[class={tbody,tr-odd,col,col-odd,col-first},elem={col},text-align={left},data-line={832},data-row={7},data-col={1},display={table-cell}]{%mdk-data-line={832}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Keyword,Psharp}{on}}%mdk-data-line={832}
{} e%mdk-data-line={832}
{}\mdSub{1}%mdk-data-line={832}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Delimiter,Psharp}{,}}%mdk-data-line={832}
{} %mdk-data-line={832}
{}{\dots}%mdk-data-line={832}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Delimiter,Psharp}{,}}%mdk-data-line={832}
{} e%mdk-data-line={832}
{}\mdSub{n}%mdk-data-line={832}
{} %mdk-data-line={832}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Keyword,Psharp}{do}}%mdk-data-line={832}
{} A%mdk-data-line={832}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Delimiter,Psharp}{;}}%mdk-data-line={832}
{}}}&\multicolumn{1}{l|}{\mdTd[class={tbody,tr-odd,col,col-even,col-last},elem={col},vertical-align={top},width={0.60\linewidth},text-align={left},data-line={832},data-row={7},data-col={2},display={table-cell}]{%mdk-data-line={832}
{} A list of events to immediately remove while examining the queue for an event to handle. Each removal causes execution of A.}}\\
\multicolumn{1}{|l}{\mdTd[class={tbody,tr-even,col,col-odd,col-first},elem={col},text-align={left},data-line={833},data-row={8},data-col={1},display={table-cell}]{%mdk-data-line={833}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Keyword,Psharp}{on}}%mdk-data-line={833}
{} e%mdk-data-line={833}
{}\mdSub{1}%mdk-data-line={833}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Delimiter,Psharp}{,}}%mdk-data-line={833}
{} %mdk-data-line={833}
{}{\dots}%mdk-data-line={833}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Delimiter,Psharp}{,}}%mdk-data-line={833}
{} e%mdk-data-line={833}
{}\mdSub{n}%mdk-data-line={833}
{} %mdk-data-line={833}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Keyword,Psharp}{do}}%mdk-data-line={833}
{} %mdk-data-line={833}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Delimiter,Curly,Psharp,BracketOpen}{\{}}%mdk-data-line={833}
{} %mdk-data-line={833}
{}{\dots}%mdk-data-line={833}
{} %mdk-data-line={833}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Delimiter,Curly,Psharp,BracketClose}{\}}}%mdk-data-line={833}
{}}}&\multicolumn{1}{l|}{\mdTd[class={tbody,tr-even,col,col-even,col-last},elem={col},vertical-align={top},width={0.60\linewidth},text-align={left},data-line={833},data-row={8},data-col={2},display={table-cell}]{%mdk-data-line={833}
{} A list of events to immediately remove while examining the queue for an event to handle. Each removal causes execution of code block.}}\\
\multicolumn{1}{|l}{\mdTd[class={tbody,tr-odd,col,col-odd,col-first},elem={col},text-align={left},data-line={834},data-row={9},data-col={1},display={table-cell}]{%mdk-data-line={834}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Keyword,Psharp}{on}}%mdk-data-line={834}
{} e%mdk-data-line={834}
{}\mdSub{1}%mdk-data-line={834}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Delimiter,Psharp}{,}}%mdk-data-line={834}
{} %mdk-data-line={834}
{}{\dots}%mdk-data-line={834}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Delimiter,Psharp}{,}}%mdk-data-line={834}
{} e%mdk-data-line={834}
{}\mdSub{n}%mdk-data-line={834}
{} %mdk-data-line={834}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Keyword,Psharp}{goto}}%mdk-data-line={834}
{} S %mdk-data-line={834}
{}[%mdk-data-line={834}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Keyword,Psharp}{with}}%mdk-data-line={834}
{} A]%mdk-data-line={834}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Delimiter,Psharp}{;}}%mdk-data-line={834}
{}}}&\multicolumn{1}{l|}{\mdTd[class={tbody,tr-odd,col,col-even,col-last},elem={col},vertical-align={top},width={0.60\linewidth},text-align={left},data-line={834},data-row={9},data-col={2},display={table-cell}]{%mdk-data-line={834}
{} A handler triggered whenever some e%mdk-data-line={834}
{}\mdSub{i}%mdk-data-line={834}
{} is encountered in the queue. Causes removal of e%mdk-data-line={834}
{}\mdSub{i}%mdk-data-line={834}
{} from queue, execution of exit function, (execution of A), and entry into state S.}}\\
\multicolumn{1}{|l}{\mdTd[class={tbody,tr-even,col,col-odd,col-first},elem={col},text-align={left},data-line={835},data-row={10},data-col={1},display={table-cell}]{%mdk-data-line={835}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Keyword,Psharp}{on}}%mdk-data-line={835}
{} e%mdk-data-line={835}
{}\mdSub{1}%mdk-data-line={835}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Delimiter,Psharp}{,}}%mdk-data-line={835}
{} %mdk-data-line={835}
{}{\dots}%mdk-data-line={835}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Delimiter,Psharp}{,}}%mdk-data-line={835}
{} e%mdk-data-line={835}
{}\mdSub{n}%mdk-data-line={835}
{} %mdk-data-line={835}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Keyword,Psharp}{goto}}%mdk-data-line={835}
{} S %mdk-data-line={835}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Keyword,Psharp}{with}}%mdk-data-line={835}
{} %mdk-data-line={835}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Delimiter,Curly,Psharp,BracketOpen}{\{}}%mdk-data-line={835}
{} %mdk-data-line={835}
{}{\dots}%mdk-data-line={835}
{} %mdk-data-line={835}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Delimiter,Curly,Psharp,BracketClose}{\}}}%mdk-data-line={835}
{}}}&\multicolumn{1}{l|}{\mdTd[class={tbody,tr-even,col,col-even,col-last},elem={col},vertical-align={top},width={0.60\linewidth},text-align={left},data-line={835},data-row={10},data-col={2},display={table-cell}]{%mdk-data-line={835}
{} A handler triggered whenever some e%mdk-data-line={835}
{}\mdSub{i}%mdk-data-line={835}
{} is encountered in the queue. Causes removal of e%mdk-data-line={835}
{}\mdSub{i}%mdk-data-line={835}
{} from queue, execution of exit function, execution of code block, and entry into state S.}}\\
\multicolumn{1}{|l}{\mdTd[class={tbody,tr-odd,tr-last,col,col-odd,col-first},elem={col},text-align={left},data-line={836},data-row={11},data-col={1},display={table-cell}]{%mdk-data-line={836}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Keyword,Psharp}{on}}%mdk-data-line={836}
{} e%mdk-data-line={836}
{}\mdSub{1}%mdk-data-line={836}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Delimiter,Psharp}{,}}%mdk-data-line={836}
{} %mdk-data-line={836}
{}{\dots}%mdk-data-line={836}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Delimiter,Psharp}{,}}%mdk-data-line={836}
{} e%mdk-data-line={836}
{}\mdSub{n}%mdk-data-line={836}
{} %mdk-data-line={836}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Keyword,Psharp}{push}}%mdk-data-line={836}
{} S%mdk-data-line={836}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Delimiter,Psharp}{;}}%mdk-data-line={836}
{}}}&\multicolumn{1}{l|}{\mdTd[class={tbody,tr-odd,tr-last,col,col-even,col-last},elem={col},vertical-align={top},width={0.60\linewidth},text-align={left},data-line={836},data-row={11},data-col={2},display={table-cell}]{%mdk-data-line={836}
{} A handler triggered whenever some e%mdk-data-line={836}
{}\mdSub{i}%mdk-data-line={836}
{} is encountered in the queue. Causes removal of e%mdk-data-line={836}
{}\mdSub{i}%mdk-data-line={836}
{} from queue, pushing of current state onto state stack, and entry into state S.}}\\
\midrule
\end{mdTable}
\begin{mdTable}[class={grammar-table,madoko,block},th-background-color={gainsboro},data-line={840}]{2}{ll}
\midrule
\multicolumn{2}{|c|}{{\cellcolor{Gainsboro}}\mdTh[class={thead,tr-odd,tr-first,col,col-odd,col-last,col-first},elem={col},data-line={841},data-row={1},text-align={center},data-col={1},display={table-cell}]{%mdk-data-line={841}
{}P%mdk-data-line={841}
{}\#%mdk-data-line={841}
{} Statements}}\\
\multicolumn{1}{|l}{{\cellcolor{Gainsboro}}\mdTh[class={thead,tr-even,tr-last,col,col-odd,col-first},elem={col},text-align={left},data-line={842},data-row={2},data-col={1},display={table-cell}]{%mdk-data-line={842}
{}Syntax}}&\multicolumn{1}{l|}{{\cellcolor{Gainsboro}}\mdTh[class={thead,tr-even,tr-last,col,col-even,col-last},elem={col},vertical-align={top},width={0.60\linewidth},text-align={left},data-line={842},data-row={2},data-col={2},display={table-cell}]{%mdk-data-line={842}
{} Description}}\\

\midrule
\multicolumn{1}{|l}{\mdTd[class={tbody,tr-odd,tr-first,col,col-odd,col-first},elem={col},text-align={left},data-line={844},data-row={1},data-col={1},display={table-cell}]{%mdk-data-line={844}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Keyword,Psharp}{create}}%mdk-data-line={844}
{} M%mdk-data-line={844}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{{\preindent{1}}\mdToken{Delimiter,Parenthesis,Psharp,BracketOpen}{(}}%mdk-data-line={844}
{}v%mdk-data-line={844}
{}\mdSub{1}%mdk-data-line={844}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Delimiter,Psharp}{,}}%mdk-data-line={844}
{} %mdk-data-line={844}
{}{\dots}%mdk-data-line={844}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Delimiter,Psharp}{,}}%mdk-data-line={844}
{} v%mdk-data-line={844}
{}\mdSub{n}%mdk-data-line={844}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Delimiter,Parenthesis,Psharp,BracketClose}{)}}%mdk-data-line={844}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Delimiter,Psharp}{;}}%mdk-data-line={844}
{}}}&\multicolumn{1}{l|}{\mdTd[class={tbody,tr-odd,tr-first,col,col-even,col-last},elem={col},vertical-align={top},width={0.60\linewidth},text-align={left},data-line={844},data-row={1},data-col={2},display={table-cell}]{%mdk-data-line={844}
{} Creates a new instance of a machine or monitor with type M, and with payload set to (v%mdk-data-line={844}
{}\mdSub{1}%mdk-data-line={844}
{}, %mdk-data-line={844}
{}{\dots}%mdk-data-line={844}
{}, v%mdk-data-line={844}
{}\mdSub{n}%mdk-data-line={844}
{}).}}\\
\multicolumn{1}{|l}{\mdTd[class={tbody,tr-even,col,col-odd,col-first},elem={col},text-align={left},data-line={845},data-row={2},data-col={1},display={table-cell}]{%mdk-data-line={845}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Keyword,Psharp}{raise}}%mdk-data-line={845}
{} ev %mdk-data-line={845}
{}[%mdk-data-line={845}
{}(v%mdk-data-line={845}
{}\mdSub{1}%mdk-data-line={845}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Delimiter,Psharp}{,}}%mdk-data-line={845}
{} %mdk-data-line={845}
{}{\dots}%mdk-data-line={845}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Delimiter,Psharp}{,}}%mdk-data-line={845}
{} v%mdk-data-line={845}
{}\mdSub{n}%mdk-data-line={845}
{}) ]%mdk-data-line={845}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Delimiter,Psharp}{;}}%mdk-data-line={845}
{}}}&\multicolumn{1}{l|}{\mdTd[class={tbody,tr-even,col,col-even,col-last},elem={col},vertical-align={top},width={0.60\linewidth},text-align={left},data-line={845},data-row={2},data-col={2},display={table-cell}]{%mdk-data-line={845}
{} Causes immediate handling of event expression ev (and sets payload to (v%mdk-data-line={845}
{}\mdSub{1}%mdk-data-line={845}
{}, %mdk-data-line={845}
{}{\dots}%mdk-data-line={845}
{}, v%mdk-data-line={845}
{}\mdSub{n}%mdk-data-line={845}
{})).}}\\
\multicolumn{1}{|l}{\mdTd[class={tbody,tr-odd,col,col-odd,col-first},elem={col},text-align={left},data-line={846},data-row={3},data-col={1},display={table-cell}]{%mdk-data-line={846}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Keyword,Psharp}{send}}%mdk-data-line={846}
{} dst%mdk-data-line={846}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Delimiter,Psharp}{,}}%mdk-data-line={846}
{} ev %mdk-data-line={846}
{}[%mdk-data-line={846}
{}(v%mdk-data-line={846}
{}\mdSub{1}%mdk-data-line={846}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Delimiter,Psharp}{,}}%mdk-data-line={846}
{} %mdk-data-line={846}
{}{\dots}%mdk-data-line={846}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Delimiter,Psharp}{,}}%mdk-data-line={846}
{} v%mdk-data-line={846}
{}\mdSub{n}%mdk-data-line={846}
{}) ]%mdk-data-line={846}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Delimiter,Psharp}{;}}%mdk-data-line={846}
{}}}&\multicolumn{1}{l|}{\mdTd[class={tbody,tr-odd,col,col-even,col-last},elem={col},vertical-align={top},width={0.60\linewidth},text-align={left},data-line={846},data-row={3},data-col={2},display={table-cell}]{%mdk-data-line={846}
{} Sends to machine expression dst event expression ev (with payload to (v%mdk-data-line={846}
{}\mdSub{1}%mdk-data-line={846}
{}, %mdk-data-line={846}
{}{\dots}%mdk-data-line={846}
{}, v%mdk-data-line={846}
{}\mdSub{n}%mdk-data-line={846}
{})).}}\\
\multicolumn{1}{|l}{\mdTd[class={tbody,tr-even,col,col-odd,col-first},elem={col},text-align={left},data-line={847},data-row={4},data-col={1},display={table-cell}]{%mdk-data-line={847}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Keyword,Psharp}{pop}}%mdk-data-line={847}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Delimiter,Psharp}{;}}%mdk-data-line={847}
{}}}&\multicolumn{1}{l|}{\mdTd[class={tbody,tr-even,col,col-even,col-last},elem={col},vertical-align={top},width={0.60\linewidth},text-align={left},data-line={847},data-row={4},data-col={2},display={table-cell}]{%mdk-data-line={847}
{} Pops this state from the state stack and returns to the parent state. Fails if the state stack is empty and the trigger is not the %mdk-data-line={847}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Keyword,Psharp}{halt}}%mdk-data-line={847}
{} event.}}\\
\multicolumn{1}{|l}{\mdTd[class={tbody,tr-odd,tr-last,col,col-odd,col-first},elem={col},text-align={left},data-line={848},data-row={5},data-col={1},display={table-cell}]{%mdk-data-line={848}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Keyword,Psharp}{assert}}%mdk-data-line={848}
{} v%mdk-data-line={848}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Delimiter,Psharp}{;}}%mdk-data-line={848}
{}}}&\multicolumn{1}{l|}{\mdTd[class={tbody,tr-odd,tr-last,col,col-even,col-last},elem={col},vertical-align={top},width={0.60\linewidth},text-align={left},data-line={848},data-row={5},data-col={2},display={table-cell}]{%mdk-data-line={848}
{} Fails if the expression v does not evaluate to %mdk-data-line={848}
{}\mdCode[class={code,code1,language-textpsharp,lang-textpsharp,textpsharp,highlighted},language={text/psharp}]{\mdToken{Keyword,Psharp}{true}}%mdk-data-line={848}
{}.}}\\
\midrule
\end{mdTable}%mdk
\end{mdDiv}%mdk
\begin{mdDiv}[class={logomadoko,block},elem={logomadoko},text-align={right},font-size={xx-small},margin-top={4em},data-line={856}]%mdk
%mdk-data-line={857}
{}Created with{\mdNbsp}\mdA{https://www.madoko.net}{}{Madoko.net}.%mdk
\end{mdDiv}%mdk%mdk
\end{mdDiv}%mdk


\end{document}
